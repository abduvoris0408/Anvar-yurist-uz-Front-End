import{r as x,I as Te,_ as ge,H as b,c as G,S as A,W as De,P as K,X as de,T as me,p as Le,g as Ve,m as Pe,a as _e,u as ze,C as Oe,am as Be,G as Ke,k as o,B as fe}from"./index-F3grSWdG.js";import{u as qe}from"./useClosable-uJIj1gsA.js";import{u as q,s as H}from"./index-DVxfzCL-.js";import{n as Ae,c as _}from"./client-CX91g6yc.js";import{C as Qe}from"./CrudDrawer-VwFJGtif.js";import{A as Ue}from"./ActionButtons-CRKm-3pF.js";import{P as We}from"./PageHeader-Cabh6d31.js";import{F as D}from"./index-Cv5QttRn.js";import{F as Xe}from"./Table-B2BAtLIv.js";import{I as Q}from"./index-CZbTi1p4.js";import{R as Ge}from"./DeleteOutlined-iu_k66-Y.js";import{U as Ye,R as Je}from"./UploadOutlined-C8kOzndP.js";import{T as Ze}from"./index-MhhX0jA_.js";import{S as et}from"./index-DEZQ1x4x.js";import{T as tt}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./index-C7_EJlaz.js";import"./DownOutlined-Bz--1KPw.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./index-Bf1aI_MO.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"},nt=function(a,r){return x.createElement(Te,ge({},a,{ref:r,icon:at}))},rt=x.forwardRef(nt);function ot(e,a){var r=e.disabled,n=e.prefixCls,s=e.character,v=e.characterRender,c=e.index,C=e.count,u=e.value,L=e.allowHalf,d=e.focused,V=e.onHover,P=e.onClick,y=function(p){V(p,c)},$=function(p){P(p,c)},T=function(p){p.keyCode===A.ENTER&&P(p,c)},k=c+1,g=new Set([n]);u===0&&c===0&&d?g.add("".concat(n,"-focused")):L&&u+.5>=k&&u<k?(g.add("".concat(n,"-half")),g.add("".concat(n,"-active")),d&&g.add("".concat(n,"-focused"))):(k<=u?g.add("".concat(n,"-full")):g.add("".concat(n,"-zero")),k===u&&d&&g.add("".concat(n,"-focused")));var f=typeof s=="function"?s(e):s,E=b.createElement("li",{className:G(Array.from(g)),ref:a},b.createElement("div",{onClick:r?null:$,onKeyDown:r?null:T,onMouseMove:r?null:y,role:"radio","aria-checked":u>c?"true":"false","aria-posinset":c+1,"aria-setsize":C,tabIndex:r?-1:0},b.createElement("div",{className:"".concat(n,"-first")},f),b.createElement("div",{className:"".concat(n,"-second")},f)));return v&&(E=v(E,e)),E}const it=b.forwardRef(ot);function st(){var e=x.useRef({});function a(n){return e.current[n]}function r(n){return function(s){e.current[n]=s}}return[a,r]}function lt(e){var a=e.pageXOffset,r="scrollLeft";if(typeof a!="number"){var n=e.document;a=n.documentElement[r],typeof a!="number"&&(a=n.body[r])}return a}function ct(e){var a,r,n=e.ownerDocument,s=n.body,v=n&&n.documentElement,c=e.getBoundingClientRect();return a=c.left,r=c.top,a-=v.clientLeft||s.clientLeft||0,r-=v.clientTop||s.clientTop||0,{left:a,top:r}}function ut(e){var a=ct(e),r=e.ownerDocument,n=r.defaultView||r.parentWindow;return a.left+=lt(n),a.left}var dt=["prefixCls","className","defaultValue","value","count","allowHalf","allowClear","keyboard","character","characterRender","disabled","direction","tabIndex","autoFocus","onHoverChange","onChange","onFocus","onBlur","onKeyDown","onMouseLeave"];function mt(e,a){var r=e.prefixCls,n=r===void 0?"rc-rate":r,s=e.className,v=e.defaultValue,c=e.value,C=e.count,u=C===void 0?5:C,L=e.allowHalf,d=L===void 0?!1:L,V=e.allowClear,P=V===void 0?!0:V,y=e.keyboard,$=y===void 0?!0:y,T=e.character,k=T===void 0?"â˜…":T,g=e.characterRender,f=e.disabled,E=e.direction,S=E===void 0?"ltr":E,p=e.tabIndex,z=p===void 0?0:p,U=e.autoFocus,t=e.onHoverChange,l=e.onChange,m=e.onFocus,w=e.onBlur,j=e.onKeyDown,I=e.onMouseLeave,he=De(e,dt),ye=st(),Y=K(ye,2),pe=Y[0],xe=Y[1],W=b.useRef(null),J=function(){if(!f){var i;(i=W.current)===null||i===void 0||i.focus()}};b.useImperativeHandle(a,function(){return{focus:J,blur:function(){if(!f){var i;(i=W.current)===null||i===void 0||i.blur()}}}});var be=de(v||0,{value:c}),Z=K(be,2),N=Z[0],Ce=Z[1],Se=de(null),ee=K(Se,2),we=ee[0],X=ee[1],te=function(i,M){var h=S==="rtl",R=i+1;if(d){var le=pe(i),ce=ut(le),ue=le.clientWidth;(h&&M-ce>ue/2||!h&&M-ce<ue/2)&&(R-=.5)}return R},B=function(i){Ce(i),l==null||l(i)},je=b.useState(!1),ae=K(je,2),Ie=ae[0],ne=ae[1],Re=function(){ne(!0),m==null||m()},ke=function(){ne(!1),w==null||w()},Fe=b.useState(null),re=K(Fe,2),oe=re[0],ie=re[1],Me=function(i,M){var h=te(M,i.pageX);h!==we&&(ie(h),X(null)),t==null||t(h)},se=function(i){f||(ie(null),X(null),t==null||t(void 0)),i&&(I==null||I(i))},Ee=function(i,M){var h=te(M,i.pageX),R=!1;P&&(R=h===N),se(),B(R?0:h),X(R?h:null)},Ne=function(i){var M=i.keyCode,h=S==="rtl",R=d?.5:1;$&&(M===A.RIGHT&&N<u&&!h?(B(N+R),i.preventDefault()):M===A.LEFT&&N>0&&!h||M===A.RIGHT&&N>0&&h?(B(N-R),i.preventDefault()):M===A.LEFT&&N<u&&h&&(B(N+R),i.preventDefault())),j==null||j(i)};b.useEffect(function(){U&&!f&&J()},[]);var He=new Array(u).fill(0).map(function(F,i){return b.createElement(it,{ref:xe(i),index:i,count:u,disabled:f,prefixCls:"".concat(n,"-star"),allowHalf:d,value:oe===null?N:oe,onClick:Ee,onHover:Me,key:F||i,character:k,characterRender:g,focused:Ie})}),$e=G(n,s,me(me({},"".concat(n,"-disabled"),f),"".concat(n,"-rtl"),S==="rtl"));return b.createElement("ul",ge({className:$e,onMouseLeave:se,tabIndex:f?-1:z,onFocus:f?null:Re,onBlur:f?null:ke,onKeyDown:f?null:Ne,ref:W},Le(he,{aria:!0,data:!0,attr:!0})),He)}const ft=b.forwardRef(mt),vt=e=>{const{componentCls:a}=e;return{[`${a}-star`]:{position:"relative",display:"inline-block",color:"inherit",cursor:"pointer","&:not(:last-child)":{marginInlineEnd:e.marginXS},"> div":{transition:`all ${e.motionDurationMid}, outline 0s`,"&:hover":{transform:e.starHoverScale},"&:focus":{outline:0},"&:focus-visible":{outline:`${ze(e.lineWidth)} dashed ${e.starColor}`,transform:e.starHoverScale}},"&-first, &-second":{color:e.starBg,transition:`all ${e.motionDurationMid}`,userSelect:"none"},"&-first":{position:"absolute",top:0,insetInlineStart:0,width:"50%",height:"100%",overflow:"hidden",opacity:0},[`&-half ${a}-star-first, &-half ${a}-star-second`]:{opacity:1},[`&-half ${a}-star-first, &-full ${a}-star-second`]:{color:"inherit"}}}},gt=e=>({[`&-rtl${e.componentCls}`]:{direction:"rtl"}}),ht=e=>{const{componentCls:a}=e;return{[a]:Object.assign(Object.assign(Object.assign(Object.assign({},_e(e)),{display:"inline-block",margin:0,padding:0,color:e.starColor,fontSize:e.starSize,lineHeight:1,listStyle:"none",outline:"none",[`&-disabled${a} ${a}-star`]:{cursor:"default","> div:hover":{transform:"scale(1)"}}}),vt(e)),gt(e))}},yt=e=>({starColor:e.yellow6,starSize:e.controlHeightLG*.5,starHoverScale:"scale(1.1)",starBg:e.colorFillContent}),pt=Ve("Rate",e=>{const a=Pe(e,{});return ht(a)},yt);var xt=function(e,a){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&a.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)a.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r};const ve=x.forwardRef((e,a)=>{const{prefixCls:r,className:n,rootClassName:s,style:v,tooltips:c,character:C=x.createElement(rt,null),disabled:u}=e,L=xt(e,["prefixCls","className","rootClassName","style","tooltips","character","disabled"]),d=(p,{index:z})=>c?x.createElement(Ae,{title:c[z]},p):p,{getPrefixCls:V,direction:P,rate:y}=x.useContext(Oe),$=V("rate",r),[T,k,g]=pt($),f=Object.assign(Object.assign({},y==null?void 0:y.style),v),E=x.useContext(Be),S=u??E;return T(x.createElement(ft,Object.assign({ref:a,character:C,characterRender:d,disabled:S},L,{className:G(n,s,k,g,y==null?void 0:y.className),style:f,prefixCls:$,direction:P})))}),O={getAll:async e=>{const{data:a}=await _.get("/testimonials",{params:e});return a},getById:async e=>{const{data:a}=await _.get(`/testimonials/${e}`);return a},create:async e=>{const{data:a}=await _.post("/testimonials",e);return a},update:async(e,a)=>{const{data:r}=await _.put(`/testimonials/${e}`,a);return r},delete:async e=>{const{data:a}=await _.delete(`/testimonials/${e}`);return a},uploadImage:async(e,a)=>{const r=new FormData;r.append("image",a);const{data:n}=await _.put(`/testimonials/${e}/image`,r,{headers:{"Content-Type":"multipart/form-data"}});return n},deleteImage:async e=>{const{data:a}=await _.delete(`/testimonials/${e}/image`);return a}},{TextArea:bt}=Q,Kt=()=>{const[e,a]=x.useState(!1),[r,n]=x.useState(null),[s,v]=x.useState(null),[c]=D.useForm(),C=Ke(),[u,L]=x.useState(""),{data:d,isLoading:V}=qe({queryKey:["testimonials"],queryFn:()=>O.getAll()}),P=x.useMemo(()=>d!=null&&d.data?u?d.data.filter(t=>t.clientName.toLowerCase().includes(u.toLowerCase())||t.content.toLowerCase().includes(u.toLowerCase())):d.data:[],[d==null?void 0:d.data,u]),y=q({mutationFn:t=>O.create(t),onSuccess:()=>{H.success("Mijoz fikri qo'shildi"),C.invalidateQueries({queryKey:["testimonials"]}),S()},onError:t=>{var m,w,j,I;console.error("Create Testimonial Error:",t);const l=((w=(m=t.response)==null?void 0:m.data)==null?void 0:w.error)||((I=(j=t.response)==null?void 0:j.data)==null?void 0:I.message)||t.message||"Noma'lum xatolik";H.error(l)}}),$=q({mutationFn:({id:t,data:l})=>O.update(t,l),onSuccess:()=>{H.success("Mijoz fikri yangilandi"),C.invalidateQueries({queryKey:["testimonials"]}),S()},onError:t=>{var m,w,j,I;console.error("Update Testimonial Error:",t);const l=((w=(m=t.response)==null?void 0:m.data)==null?void 0:w.error)||((I=(j=t.response)==null?void 0:j.data)==null?void 0:I.message)||t.message||"Noma'lum xatolik";H.error(l)}}),T=q({mutationFn:t=>O.delete(t),onSuccess:()=>{H.success("Mijoz fikri o'chirildi"),C.invalidateQueries({queryKey:["testimonials"]})},onError:t=>{var m,w,j,I;console.error("Delete Testimonial Error:",t);const l=((w=(m=t.response)==null?void 0:m.data)==null?void 0:w.error)||((I=(j=t.response)==null?void 0:j.data)==null?void 0:I.message)||t.message||"Noma'lum xatolik";H.error(l)}}),k=q({mutationFn:({id:t,file:l})=>O.uploadImage(t,l),onSuccess:t=>{H.success("Rasm yuklandi!"),C.invalidateQueries({queryKey:["testimonials"]}),v(l=>{var m;return l&&{...l,image:(m=t.data)==null?void 0:m.image}})},onError:()=>H.error("Rasm yuklashda xatolik")}),g=q({mutationFn:t=>O.deleteImage(t),onSuccess:()=>{H.success("Rasm o'chirildi!"),C.invalidateQueries({queryKey:["testimonials"]}),v(t=>t&&{...t,image:void 0})},onError:()=>H.error("Rasm o'chirishda xatolik")}),f=()=>{n(null),v(null),c.resetFields(),a(!0)},E=t=>{n(t.id),v(t),c.setFieldsValue(t),a(!0)},S=()=>{a(!1),n(null),v(null),c.resetFields()},p=t=>{const{image:l,...m}=t;r?$.mutate({id:r,data:m}):y.mutate(m)},z=t=>{if(t){if(typeof t=="string")return t;if(typeof t=="object"&&t.url)return t.url}},U=[{title:"Mijoz",dataIndex:"clientName",key:"clientName",render:(t,l)=>o.jsxs("div",{children:[o.jsx("div",{className:"font-medium",children:t}),o.jsx("div",{className:"text-xs text-gray-500",children:l.clientPosition})]})},{title:"Baho",dataIndex:"rating",key:"rating",render:t=>o.jsx(ve,{disabled:!0,defaultValue:t,style:{fontSize:12}}),sorter:(t,l)=>t.rating-l.rating},{title:"Fikr",dataIndex:"content",key:"content",ellipsis:!0},{title:"Holat",dataIndex:"isActive",key:"isActive",render:t=>o.jsx(tt,{color:t?"green":"red",children:t?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(t,l)=>o.jsx(Ue,{onEdit:()=>E(l),onDelete:()=>T.mutate(l.id),deleteLoading:T.isPending})}];return o.jsxs(o.Fragment,{children:[o.jsx(We,{title:"Mijoz Fikrlari",onAdd:f,addButtonText:"Yangi fikr",onSearch:L,searchPlaceholder:"Mijoz ismi yoki fikr bo'yicha qidirish...",children:o.jsx(Xe,{columns:U,dataSource:P,rowKey:"id",loading:V,pagination:{pageSize:10}})}),o.jsxs(Qe,{title:r?"Fikrni tahrirlash":"Yangi fikr qo'shish",open:e,onClose:S,loading:y.isPending||$.isPending,form:c,onSubmit:p,isEdit:!!r,children:[o.jsx(D.Item,{name:"clientName",label:"Mijoz Ismi",rules:[{required:!0,message:"Mijoz ismini kiriting"}],children:o.jsx(Q,{placeholder:"Mijoz ismini kiriting"})}),o.jsx(D.Item,{name:"clientPosition",label:"Lavozimi",children:o.jsx(Q,{placeholder:"Direktor, Kompaniya"})}),s&&o.jsx(D.Item,{label:"Mijoz rasmi",children:o.jsxs("div",{className:"space-y-2",children:[z(s.image)&&o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:z(s.image),alt:"Preview",style:{width:80,height:80,objectFit:"cover",borderRadius:"50%"}}),o.jsx(fe,{danger:!0,size:"small",icon:o.jsx(Ge,{}),onClick:()=>g.mutate(s.id),loading:g.isPending,style:{position:"absolute",top:0,right:0}})]}),o.jsx(Ye,{showUploadList:!1,accept:"image/*",beforeUpload:t=>(k.mutate({id:s.id,file:t}),!1),children:o.jsx(fe,{icon:o.jsx(Je,{}),loading:k.isPending,children:"Rasm yuklash"})})]})}),o.jsx(D.Item,{name:"caseType",label:"Ish turi",children:o.jsx(Q,{placeholder:"Huquqiy maslahat, Shartnoma tayyorlash..."})}),o.jsx(D.Item,{name:"rating",label:"Baho (1-5)",rules:[{required:!0,message:"Bahoni tanlang"}],initialValue:5,children:o.jsx(ve,{})}),o.jsx(D.Item,{name:"content",label:"Fikr matni",rules:[{required:!0,message:"Fikr matnini kiriting"}],children:o.jsx(bt,{rows:4,placeholder:"Mijoz fikrini shu yerga yozing..."})}),o.jsx(D.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:o.jsx(Ze,{min:1,className:"w-full"})}),o.jsx(D.Item,{name:"isActive",label:"Holati",valuePropName:"checked",initialValue:!0,children:o.jsx(et,{checkedChildren:"Faol",unCheckedChildren:"Nofaol"})})]})]})};export{Kt as default};
