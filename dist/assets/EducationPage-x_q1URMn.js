import{r as x,G as z,k as t,B as q}from"./index-F3grSWdG.js";import{u as A}from"./useClosable-uJIj1gsA.js";import{u as f,s as l}from"./index-DVxfzCL-.js";import{c as u}from"./client-CX91g6yc.js";import{C as B}from"./CrudDrawer-VwFJGtif.js";import{A as K}from"./ActionButtons-CRKm-3pF.js";import{P as N}from"./PageHeader-Cabh6d31.js";import{d as j}from"./dayjs.min-DsquTRpG.js";import{F as n}from"./index-Cv5QttRn.js";import{F as Q}from"./Table-B2BAtLIv.js";import{I as m}from"./index-CZbTi1p4.js";import{R}from"./DeleteOutlined-iu_k66-Y.js";import{U as $,R as U}from"./UploadOutlined-C8kOzndP.js";import{S as H}from"./index-lsxE6RmN.js";import{D as T}from"./index-CEqjeAe3.js";import{S as X}from"./index-DEZQ1x4x.js";import{T as G}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-C7_EJlaz.js";import"./DownOutlined-Bz--1KPw.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./index-Bf1aI_MO.js";const h={getAll:async r=>{const{data:s}=await u.get("/education",{params:r});return s},getById:async r=>{const{data:s}=await u.get(`/education/${r}`);return s},create:async r=>{const{data:s}=await u.post("/education",r);return s},update:async(r,s)=>{const{data:i}=await u.put(`/education/${r}`,s);return i},delete:async r=>{const{data:s}=await u.delete(`/education/${r}`);return s},uploadLogo:async(r,s)=>{const i=new FormData;i.append("logo",s);const{data:c}=await u.put(`/education/${r}/logo`,i,{headers:{"Content-Type":"multipart/form-data"}});return c},deleteLogo:async r=>{const{data:s}=await u.delete(`/education/${r}/logo`);return s}},{TextArea:J}=m,je=()=>{const[r,s]=x.useState(!1),[i,c]=x.useState(null),[p,F]=x.useState(""),[y]=n.useForm(),g=z(),{data:d,isLoading:M}=A({queryKey:["education"],queryFn:()=>h.getAll({limit:100})}),C=x.useMemo(()=>p?((d==null?void 0:d.data)||[]).filter(e=>{var a,o;return e.school.toLowerCase().includes(p.toLowerCase())||((a=e.degree)==null?void 0:a.toLowerCase().includes(p.toLowerCase()))||((o=e.fieldOfStudy)==null?void 0:o.toLowerCase().includes(p.toLowerCase()))}):(d==null?void 0:d.data)||[],[d==null?void 0:d.data,p]),b=f({mutationFn:e=>h.create(e),onSuccess:()=>{l.success("Ta'lim yaratildi!"),g.invalidateQueries({queryKey:["education"]}),D()},onError:e=>{var a,o;l.error(((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.error)||e.message||"Xatolik yuz berdi")}}),L=f({mutationFn:({id:e,data:a})=>h.update(e,a),onSuccess:()=>{l.success("Ta'lim yangilandi!"),g.invalidateQueries({queryKey:["education"]}),D()},onError:e=>{var a,o;l.error(((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.error)||e.message||"Xatolik yuz berdi")}}),Y=f({mutationFn:e=>h.delete(e),onSuccess:()=>{l.success("Ta'lim o'chirildi!"),g.invalidateQueries({queryKey:["education"]})},onError:()=>l.error("Xatolik yuz berdi")}),S=f({mutationFn:({id:e,file:a})=>h.uploadLogo(e,a),onSuccess:e=>{l.success("Logo yuklandi!"),g.invalidateQueries({queryKey:["education"]}),c(a=>{var o;return a&&{...a,schoolLogo:(o=e.data)==null?void 0:o.schoolLogo}})},onError:()=>l.error("Logo yuklashda xatolik")}),k=f({mutationFn:e=>h.deleteLogo(e),onSuccess:()=>{l.success("Logo o'chirildi!"),g.invalidateQueries({queryKey:["education"]}),c(e=>e&&{...e,schoolLogo:void 0})},onError:()=>l.error("Logo o'chirishda xatolik")}),w=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},v=e=>{e?(c(e),y.setFieldsValue({...e,startDate:e.startDate?j(e.startDate):null,endDate:e.endDate?j(e.endDate):null})):(c(null),y.resetFields()),s(!0)},D=()=>{s(!1),c(null),y.resetFields()},E=async e=>{const{schoolLogo:a,...o}=e,I={...o,startDate:o.startDate?o.startDate.format("YYYY-MM-DD"):void 0,endDate:o.current?null:o.endDate?o.endDate.format("YYYY-MM-DD"):void 0,gpa:o.gpa?Number(o.gpa):void 0,achievements:typeof o.achievements=="string"?o.achievements.split(",").map(P=>P.trim()).filter(Boolean):o.achievements};i?L.mutate({id:i.id,data:I}):b.mutate(I)},O=[{title:"Logo",dataIndex:"schoolLogo",key:"schoolLogo",width:50,render:e=>{const a=w(e);return a?t.jsx("img",{src:a,alt:"",style:{width:32,height:32,objectFit:"contain",borderRadius:4}}):"-"}},{title:"O'quv muassasasi",dataIndex:"school",key:"school",sorter:(e,a)=>e.school.localeCompare(a.school),render:e=>t.jsx("strong",{children:e})},{title:"Daraja",dataIndex:"degree",key:"degree"},{title:"Yo'nalish",dataIndex:"fieldOfStudy",key:"fieldOfStudy"},{title:"Davr",key:"period",render:(e,a)=>t.jsxs("span",{children:[j(a.startDate).format("YYYY")," - ",a.current?t.jsx(G,{color:"green",children:"Hozir"}):j(a.endDate).format("YYYY")]})},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(K,{onEdit:()=>v(a),onDelete:()=>Y.mutate(a.id),deleteLoading:Y.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(N,{title:"Ta'lim",onAdd:()=>v(),addButtonText:"Yangi ta'lim",onSearch:F,searchPlaceholder:"Ta'limni qidirish...",children:t.jsx(Q,{columns:O,dataSource:C,rowKey:"id",loading:M,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Jami: ${e}`},size:"middle"})}),t.jsxs(B,{open:r,onClose:D,title:i?"Ta'limni tahrirlash":"Yangi ta'lim",loading:b.isPending||L.isPending,form:y,onSubmit:E,isEdit:!!i,width:450,children:[t.jsx(n.Item,{name:"school",label:"O'quv muassasasi",rules:[{required:!0}],children:t.jsx(m,{placeholder:"TDYU"})}),t.jsx(n.Item,{name:"degree",label:"Daraja",rules:[{required:!0}],children:t.jsx(m,{placeholder:"Bakalavr"})}),t.jsx(n.Item,{name:"fieldOfStudy",label:"O'qish yo'nalishi",rules:[{required:!0}],children:t.jsx(m,{placeholder:"Huquqshunoslik"})}),t.jsx(n.Item,{name:"location",label:"Joylashuv",children:t.jsx(m,{placeholder:"Toshkent, O'zbekiston"})}),t.jsx(n.Item,{name:"description",label:"Tavsif",children:t.jsx(J,{rows:3,placeholder:"Ta'lim haqida"})}),i&&t.jsx(n.Item,{label:"Muassasa logosi",children:t.jsxs("div",{className:"space-y-2",children:[w(i.schoolLogo)&&t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:w(i.schoolLogo),alt:"Logo",style:{width:64,height:64,objectFit:"contain",borderRadius:8,border:"1px solid #eee"}}),t.jsx(q,{danger:!0,size:"small",icon:t.jsx(R,{}),onClick:()=>k.mutate(i.id),loading:k.isPending,style:{position:"absolute",top:-8,right:-8}})]}),t.jsx($,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(S.mutate({id:i.id,file:e}),!1),children:t.jsx(q,{icon:t.jsx(U,{}),loading:S.isPending,children:"Logo yuklash"})})]})}),t.jsxs(H,{className:"w-full",size:"middle",children:[t.jsx(n.Item,{name:"startDate",label:"Boshlanish",rules:[{required:!0}],children:t.jsx(T,{className:"w-full",format:"YYYY-MM-DD"})}),t.jsx(n.Item,{name:"endDate",label:"Tugash",children:t.jsx(T,{className:"w-full",format:"YYYY-MM-DD"})})]}),t.jsx(n.Item,{name:"current",label:"Hozirda o'qiyapman",valuePropName:"checked",children:t.jsx(X,{})}),t.jsx(n.Item,{name:"gpa",label:"GPA (Baho)",children:t.jsx(m,{type:"number",step:"0.1",placeholder:"4.5"})}),t.jsx(n.Item,{name:"achievements",label:"Yutuqlar (vergul bilan)",children:t.jsx(m,{placeholder:"Stipendiat, Olim, ..."})})]})]})};export{je as default};
