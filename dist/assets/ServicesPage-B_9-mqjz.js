import{r as f,I as oe,_ as le,G as ce,k as a,B as g}from"./index-isBeRo1b.js";import{u as q}from"./useClosable-Dwegbn33.js";import{u as y,s as d}from"./index-DOY2cXOq.js";import{c as p,j as U}from"./client-D49sAvGJ.js";import{c as de}from"./categories--hKE1BeI.js";import{C as X}from"./CrudDrawer-CCohrQdE.js";import{P as me}from"./PageHeader-CzhsRgKs.js";import{u as ue}from"./useDebounce-D60A3ZKm.js";import{F as u}from"./index-CO1TAYVF.js";import{R as H,C as pe,S as T}from"./index-CUCRgLKV.js";import{F as B}from"./Table-CbaHfp0x.js";import{I as j}from"./index-BiEyZbEs.js";import{R as C}from"./DeleteOutlined-BdlBkdV1.js";import{U as he,R as xe}from"./UploadOutlined-C9sZaBMJ.js";import{S as L,P as Y}from"./index-DeMcSX5K.js";import{T as _}from"./index-DF4za2Tw.js";import{S as ge}from"./index-Aatx205e.js";import{D as ye}from"./index-CK1P3WPV.js";import{T as V}from"./index-CDKBTdtS.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./DownOutlined-C7Jp90Yl.js";import"./index-Dh7qLhW3.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},je=function(t,n){return f.createElement(oe,le({},t,{ref:n,icon:fe}))},ve=f.forwardRef(je);const h={getAll:async i=>{const{data:t}=await p.get("/services",{params:i});return t},getById:async i=>{const{data:t}=await p.get(`/services/${i}`);return t},create:async i=>{const{data:t}=await p.post("/services",i);return t},update:async(i,t)=>{const{data:n}=await p.put(`/services/${i}`,t);return n},delete:async i=>{const{data:t}=await p.delete(`/services/${i}`);return t},uploadImage:async(i,t)=>{const n=new FormData;n.append("image",t);const{data:k}=await p.put(`/services/${i}/image`,n,{headers:{"Content-Type":"multipart/form-data"}});return k},deleteImage:async i=>{const{data:t}=await p.delete(`/services/${i}/image`);return t},getAllDetails:async i=>{const{data:t}=await p.get("/service-details",{params:i});return t},getDetailById:async i=>{const{data:t}=await p.get(`/service-details/${i}`);return t},createDetail:async i=>{const{data:t}=await p.post("/service-details",i);return t},updateDetail:async(i,t)=>{const{data:n}=await p.put(`/service-details/${i}`,t);return n},deleteDetail:async i=>{const{data:t}=await p.delete(`/service-details/${i}`);return t}},He=()=>{var Q;const[i]=u.useForm(),[t]=u.useForm(),n=ce(),[k,I]=f.useState(!1),[x,v]=f.useState(null),[G,w]=f.useState(!1),[m,E]=f.useState(null),[S,b]=f.useState(null),[J,W]=f.useState(""),N=ue(J,500),{data:F,isLoading:Z}=q({queryKey:["services",N],queryFn:()=>h.getAll({search:N})}),{data:z}=q({queryKey:["categories"],queryFn:()=>de.getAll()}),{data:D}=q({queryKey:["service-details",m==null?void 0:m.id],queryFn:()=>h.getAllDetails({serviceId:m==null?void 0:m.id}),enabled:!!m}),M=y({mutationFn:e=>h.create(e),onSuccess:()=>{d.success("Xizmat yaratildi!"),n.invalidateQueries({queryKey:["services"]}),I(!1),i.resetFields()},onError:e=>{var r,o,l,c;console.error("Create Service Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),R=y({mutationFn:({id:e,values:s})=>h.update(e,s),onSuccess:()=>{d.success("Xizmat yangilandi!"),n.invalidateQueries({queryKey:["services"]}),I(!1),v(null),i.resetFields()},onError:e=>{var r,o,l,c;console.error("Update Service Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),ee=y({mutationFn:e=>h.delete(e),onSuccess:()=>{d.success("Xizmat o'chirildi!"),n.invalidateQueries({queryKey:["services"]})},onError:e=>{var r,o,l,c;console.error("Delete Service Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),P=y({mutationFn:({id:e,file:s})=>h.uploadImage(e,s),onSuccess:e=>{d.success("Rasm yuklandi!"),n.invalidateQueries({queryKey:["services"]}),v(s=>{var r;return s&&{...s,image:(r=e.data)==null?void 0:r.image}})},onError:()=>d.error("Rasm yuklashda xatolik")}),K=y({mutationFn:e=>h.deleteImage(e),onSuccess:()=>{d.success("Rasm o'chirildi!"),n.invalidateQueries({queryKey:["services"]}),v(e=>e&&{...e,image:void 0})},onError:()=>d.error("Rasm o'chirishda xatolik")}),$=y({mutationFn:e=>h.createDetail(e),onSuccess:()=>{d.success("Tafsilot yaratildi!"),n.invalidateQueries({queryKey:["service-details"]}),w(!1),t.resetFields()},onError:e=>{var r,o,l,c;console.error("Create Service Detail Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),A=y({mutationFn:({id:e,values:s})=>h.updateDetail(e,s),onSuccess:()=>{d.success("Tafsilot yangilandi!"),n.invalidateQueries({queryKey:["service-details"]}),w(!1),b(null),t.resetFields()},onError:e=>{var r,o,l,c;console.error("Update Service Detail Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),ae=y({mutationFn:e=>h.deleteDetail(e),onSuccess:()=>{d.success("Tafsilot o'chirildi!"),n.invalidateQueries({queryKey:["service-details"]})},onError:e=>{var r,o,l,c;console.error("Delete Service Detail Error:",e);const s=((o=(r=e.response)==null?void 0:r.data)==null?void 0:o.error)||((c=(l=e.response)==null?void 0:l.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";d.error(s)}}),O=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},te=e=>{const{image:s,...r}=e;x?R.mutate({id:x.id,values:r}):M.mutate(r)},se=e=>{if(S)A.mutate({id:S.id,values:e});else{const s=m==null?void 0:m.id;$.mutate({...e,serviceId:s})}},ie=e=>{v(e),i.setFieldsValue(e),I(!0)},re=[{title:"Icon",dataIndex:"icon",key:"icon",width:60,render:e=>a.jsx("span",{style:{fontSize:20},children:e||"ðŸ”§"})},{title:"Nomi",dataIndex:"title",key:"title"},{title:"Narx",dataIndex:"price",key:"price"},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e?a.jsx(V,{children:e.name}):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>a.jsx(V,{color:e?"green":"default",children:e?"Faol":"Nofaol"})},{title:"Tartib",dataIndex:"order",key:"order",width:80},{title:"Amallar",key:"actions",width:150,render:(e,s)=>a.jsxs(T,{children:[a.jsx(g,{size:"small",icon:a.jsx(ve,{}),onClick:()=>E(s),title:"Tafsilotlar"}),a.jsx(g,{size:"small",icon:a.jsx(U,{}),onClick:()=>ie(s)}),a.jsx(Y,{title:"O'chirishni tasdiqlaysizmi?",onConfirm:()=>ee.mutate(s.id),children:a.jsx(g,{size:"small",danger:!0,icon:a.jsx(C,{})})})]})}],ne=[{title:"Icon",dataIndex:"icon",key:"icon",width:60,render:e=>a.jsx("span",{style:{fontSize:18},children:e||"â€¢"})},{title:"Nomi",dataIndex:"title",key:"title"},{title:"Tavsif",dataIndex:"description",key:"description",ellipsis:!0},{title:"Tartib",dataIndex:"order",key:"order",width:80},{title:"Amallar",key:"actions",width:120,render:(e,s)=>a.jsxs(T,{children:[a.jsx(g,{size:"small",icon:a.jsx(U,{}),onClick:()=>{b(s),t.setFieldsValue(s),w(!0)}}),a.jsx(Y,{title:"O'chirish?",onConfirm:()=>ae.mutate(s.id),children:a.jsx(g,{size:"small",danger:!0,icon:a.jsx(C,{})})})]})}];return a.jsxs("div",{className:"space-y-4",children:[a.jsx(me,{title:"Xizmatlar",subtitle:"Xizmatlarni boshqarish",extra:a.jsx(g,{type:"primary",icon:a.jsx(H,{}),onClick:()=>{v(null),i.resetFields(),I(!0)},children:"Yangi xizmat"}),onSearch:W,searchPlaceholder:"Xizmat nomi bo'yicha qidirish..."}),a.jsx(pe,{children:a.jsx(B,{columns:re,dataSource:(F==null?void 0:F.data)||[],rowKey:"id",loading:Z,pagination:{pageSize:10}})}),a.jsxs(X,{open:k,onClose:()=>{I(!1),v(null),i.resetFields()},title:x?"Xizmatni yangilash":"Yangi xizmat",form:i,onSubmit:te,loading:M.isPending||R.isPending,isEdit:!!x,children:[a.jsx(u.Item,{name:"title",label:"Nomi",rules:[{required:!0}],children:a.jsx(j,{placeholder:"Huquqiy maslahat"})}),a.jsx(u.Item,{name:"description",label:"Tavsif",children:a.jsx(j.TextArea,{rows:3,placeholder:"Professional huquqiy xizmatlar..."})}),a.jsx(u.Item,{name:"icon",label:"Icon (emoji)",children:a.jsx(j,{placeholder:"ðŸŒ"})}),x&&a.jsx(u.Item,{label:"Rasm",children:a.jsxs("div",{className:"space-y-2",children:[O(x.image)&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:O(x.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),a.jsx(g,{danger:!0,size:"small",icon:a.jsx(C,{}),onClick:()=>K.mutate(x.id),loading:K.isPending,style:{position:"absolute",top:8,right:8}})]}),a.jsx(he,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(P.mutate({id:x.id,file:e}),!1),children:a.jsx(g,{icon:a.jsx(xe,{}),loading:P.isPending,children:"Rasm yuklash"})})]})}),a.jsx(u.Item,{name:"categoryId",label:"Kategoriya",children:a.jsx(L,{placeholder:"Tanlang",allowClear:!0,children:(Q=z==null?void 0:z.data)==null?void 0:Q.map(e=>a.jsx(L.Option,{value:e.id,children:e.name},e.id))})}),a.jsx(u.Item,{name:"price",label:"Narx",children:a.jsx(j,{placeholder:"dan $500"})}),a.jsx(u.Item,{name:"order",label:"Tartib",children:a.jsx(_,{min:0,className:"w-full"})}),a.jsx(u.Item,{name:"isActive",label:"Faol",valuePropName:"checked",children:a.jsx(ge,{})})]}),a.jsx(ye,{title:`${(m==null?void 0:m.title)||""} â€” Tafsilotlar`,open:!!m,onClose:()=>{E(null),b(null)},width:600,styles:{body:{padding:"16px",background:"var(--bg-card)"},header:{background:"var(--bg-card)"},content:{background:"var(--bg-card)"}},children:a.jsxs(T,{direction:"vertical",className:"w-full",size:"middle",children:[a.jsx(g,{type:"primary",icon:a.jsx(H,{}),onClick:()=>{b(null),t.resetFields(),w(!0)},children:"Yangi tafsilot"}),a.jsx(B,{columns:ne,dataSource:(D==null?void 0:D.data)||[],rowKey:"id",pagination:!1,size:"small"})]})}),a.jsxs(X,{open:G,onClose:()=>{w(!1),b(null),t.resetFields()},title:S?"Tafsilotni yangilash":"Yangi tafsilot",form:t,onSubmit:se,loading:$.isPending||A.isPending,isEdit:!!S,width:380,children:[a.jsx(u.Item,{name:"title",label:"Nomi",rules:[{required:!0}],children:a.jsx(j,{placeholder:"Shartnomalar tayyorlash"})}),a.jsx(u.Item,{name:"description",label:"Tavsif",children:a.jsx(j.TextArea,{rows:2,placeholder:"Professional shartnomalar"})}),a.jsx(u.Item,{name:"icon",label:"Icon (emoji)",children:a.jsx(j,{placeholder:"ðŸ“±"})}),a.jsx(u.Item,{name:"order",label:"Tartib",children:a.jsx(_,{min:0,className:"w-full"})})]})]})};export{He as default};
