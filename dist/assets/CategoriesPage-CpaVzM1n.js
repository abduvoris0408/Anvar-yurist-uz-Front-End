import{r as x,G as B,k as t,B as R}from"./index-isBeRo1b.js";import{u as H}from"./useClosable-Dwegbn33.js";import{u as p,s as i}from"./index-DOY2cXOq.js";import"./client-D49sAvGJ.js";import{c}from"./categories--hKE1BeI.js";import{C as L}from"./CrudDrawer-CCohrQdE.js";import{A as z}from"./ActionButtons-MGrXOT8T.js";import{P as Y}from"./PageHeader-CzhsRgKs.js";import{u as G}from"./useDebounce-D60A3ZKm.js";import{F as l}from"./index-CO1TAYVF.js";import{F as V}from"./Table-CbaHfp0x.js";import{I}from"./index-BiEyZbEs.js";import{S as d}from"./index-DeMcSX5K.js";import{C as X}from"./ColorPicker-B6dSZ5qn.js";import{R as _}from"./DeleteOutlined-BdlBkdV1.js";import{U as $,R as J}from"./UploadOutlined-C9sZaBMJ.js";import{T as q}from"./index-CDKBTdtS.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./index-CUCRgLKV.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./DownOutlined-C7Jp90Yl.js";import"./index-Dh7qLhW3.js";import"./index-DF4za2Tw.js";import"./index-BaCf-Qju.js";const Se=()=>{const[P,j]=x.useState(!1),[h,f]=x.useState(null),[u,m]=x.useState(null),[y]=l.useForm(),g=B(),[T,M]=x.useState(""),S=G(T,500),{data:k,isLoading:A}=H({queryKey:["categories",S],queryFn:()=>c.getAll({search:S})}),D=(k==null?void 0:k.data)||[],v=p({mutationFn:e=>c.create(e),onSuccess:()=>{i.success("Kategoriya yaratildi"),g.invalidateQueries({queryKey:["categories"]}),b()},onError:e=>{var o,r,s,n;console.error("Create Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((n=(s=e.response)==null?void 0:s.data)==null?void 0:n.message)||e.message||"Noma'lum xatolik";i.error(a)}}),C=p({mutationFn:({id:e,data:a})=>c.update(e,a),onSuccess:()=>{i.success("Kategoriya yangilandi"),g.invalidateQueries({queryKey:["categories"]}),b()},onError:e=>{var o,r,s,n;console.error("Update Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((n=(s=e.response)==null?void 0:s.data)==null?void 0:n.message)||e.message||"Noma'lum xatolik";i.error(a)}}),K=p({mutationFn:e=>c.delete(e),onSuccess:()=>{i.success("Kategoriya o'chirildi"),g.invalidateQueries({queryKey:["categories"]})},onError:e=>{var o,r,s,n;console.error("Delete Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((n=(s=e.response)==null?void 0:s.data)==null?void 0:n.message)||e.message||"Noma'lum xatolik";i.error(a)}}),F=p({mutationFn:({id:e,file:a})=>c.uploadImage(e,a),onSuccess:e=>{i.success("Rasm yuklandi!"),g.invalidateQueries({queryKey:["categories"]}),m(a=>{var o;return a&&{...a,image:(o=e.data)==null?void 0:o.image}})},onError:()=>i.error("Rasm yuklashda xatolik")}),w=p({mutationFn:e=>c.deleteImage(e),onSuccess:()=>{i.success("Rasm o'chirildi!"),g.invalidateQueries({queryKey:["categories"]}),m(e=>e&&{...e,image:void 0})},onError:()=>i.error("Rasm o'chirishda xatolik")}),N=()=>{f(null),m(null),y.resetFields(),j(!0)},O=e=>{f(e.id),m(e),y.setFieldsValue(e),j(!0)},b=()=>{j(!1),f(null),m(null),y.resetFields()},Q=e=>{var s;const{image:a,...o}=e,r={...o,color:typeof o.color=="object"&&((s=o.color)!=null&&s.toHexString)?o.color.toHexString():o.color};h?C.mutate({id:h,data:r}):v.mutate(r)},E=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},U=[{title:"Rang",dataIndex:"color",key:"color",width:60,render:e=>t.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:e||"#ccc"}})},{title:"Nomi",dataIndex:"name",key:"name",render:(e,a)=>t.jsx(q,{color:a.color,children:e})},{title:"Slug",dataIndex:"slug",key:"slug"},{title:"Turi",dataIndex:"type",key:"type",render:e=>{const a={project:"blue",blog:"green",service:"purple",skill:"orange",news:"cyan"};return t.jsx(q,{color:a[e]||"default",children:e})}},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(z,{onEdit:()=>O(a),onDelete:()=>K.mutate(a.id),deleteLoading:K.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(Y,{title:"Kategoriyalar",onAdd:N,addButtonText:"Yangi kategoriya",onSearch:M,searchPlaceholder:"Kategoriya nomi bo'yicha qidirish...",children:t.jsx(V,{columns:U,dataSource:D,rowKey:"id",loading:A,pagination:{pageSize:10}})}),t.jsxs(L,{title:h?"Kategoriyani tahrirlash":"Yangi kategoriya",open:P,onClose:b,loading:v.isPending||C.isPending,form:y,onSubmit:Q,isEdit:!!h,children:[t.jsx(l.Item,{name:"name",label:"Kategoriya nomi",rules:[{required:!0,message:"Nomini kiriting"}],children:t.jsx(I,{placeholder:"Huquq sohasi"})}),t.jsx(l.Item,{name:"type",label:"Turi",rules:[{required:!0,message:"Turini tanlang"}],children:t.jsxs(d,{placeholder:"Kategoriya turini tanlang",children:[t.jsx(d.Option,{value:"project",children:"Loyiha (project)"}),t.jsx(d.Option,{value:"blog",children:"Blog (blog)"}),t.jsx(d.Option,{value:"service",children:"Xizmat (service)"}),t.jsx(d.Option,{value:"skill",children:"Ko'nikma (skill)"}),t.jsx(d.Option,{value:"news",children:"Yangilik (news)"})]})}),t.jsx(l.Item,{name:"description",label:"Tavsif",children:t.jsx(I.TextArea,{rows:2,placeholder:"Kategoriya tavsifi"})}),t.jsx(l.Item,{name:"color",label:"Rang",children:t.jsx(X,{format:"hex"})}),t.jsx(l.Item,{name:"icon",label:"Icon (emoji yoki CSS class)",children:t.jsx(I,{placeholder:"ðŸŒ yoki fa-globe"})}),u&&t.jsx(l.Item,{label:"Rasm",children:t.jsxs("div",{className:"space-y-2",children:[E(u.image)&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:E(u.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),t.jsx(R,{danger:!0,size:"small",icon:t.jsx(_,{}),onClick:()=>w.mutate(u.id),loading:w.isPending,style:{position:"absolute",top:8,right:8}})]}),t.jsx($,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(F.mutate({id:u.id,file:e}),!1),children:t.jsx(R,{icon:t.jsx(J,{}),loading:F.isPending,children:"Rasm yuklash"})})]})})]})]})};export{Se as default};
