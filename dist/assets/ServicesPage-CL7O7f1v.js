import{r as j,I as ie,_ as re,G as ne,k as a,B as y}from"./index-F3grSWdG.js";import{u as q}from"./useClosable-uJIj1gsA.js";import{u as h,s as c}from"./index-DVxfzCL-.js";import{c as p,j as Q}from"./client-CX91g6yc.js";import{c as le}from"./categories-C0Tbv_kI.js";import{C as U}from"./CrudDrawer-VwFJGtif.js";import{P as oe}from"./PageHeader-Cabh6d31.js";import{F as u}from"./index-Cv5QttRn.js";import{R as H,C as de,S as C}from"./index-lsxE6RmN.js";import{F as X}from"./Table-B2BAtLIv.js";import{I as f}from"./index-CZbTi1p4.js";import{R as E}from"./DeleteOutlined-iu_k66-Y.js";import{U as ce,R as me}from"./UploadOutlined-C8kOzndP.js";import{S as B,P as L}from"./index-C7_EJlaz.js";import{T as Y}from"./index-MhhX0jA_.js";import{S as ue}from"./index-DEZQ1x4x.js";import{D as pe}from"./index-Dj6CL_jc.js";import{T as _}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./DownOutlined-Bz--1KPw.js";import"./index-Bf1aI_MO.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},xe=function(t,n){return j.createElement(ie,re({},t,{ref:n,icon:ge}))},ye=j.forwardRef(xe);const g={getAll:async i=>{const{data:t}=await p.get("/services",{params:i});return t},getById:async i=>{const{data:t}=await p.get(`/services/${i}`);return t},create:async i=>{const{data:t}=await p.post("/services",i);return t},update:async(i,t)=>{const{data:n}=await p.put(`/services/${i}`,t);return n},delete:async i=>{const{data:t}=await p.delete(`/services/${i}`);return t},uploadImage:async(i,t)=>{const n=new FormData;n.append("image",t);const{data:S}=await p.put(`/services/${i}/image`,n,{headers:{"Content-Type":"multipart/form-data"}});return S},deleteImage:async i=>{const{data:t}=await p.delete(`/services/${i}/image`);return t},getAllDetails:async i=>{const{data:t}=await p.get("/service-details",{params:i});return t},getDetailById:async i=>{const{data:t}=await p.get(`/service-details/${i}`);return t},createDetail:async i=>{const{data:t}=await p.post("/service-details",i);return t},updateDetail:async(i,t)=>{const{data:n}=await p.put(`/service-details/${i}`,t);return n},deleteDetail:async i=>{const{data:t}=await p.delete(`/service-details/${i}`);return t}},Ae=()=>{var O;const[i]=u.useForm(),[t]=u.useForm(),n=ne(),[S,I]=j.useState(!1),[x,v]=j.useState(null),[V,w]=j.useState(!1),[m,T]=j.useState(null),[k,b]=j.useState(null),{data:F,isLoading:G}=q({queryKey:["services"],queryFn:()=>g.getAll()}),{data:z}=q({queryKey:["categories"],queryFn:()=>le.getAll()}),{data:D}=q({queryKey:["service-details",m==null?void 0:m.id],queryFn:()=>g.getAllDetails({serviceId:m==null?void 0:m.id}),enabled:!!m}),N=h({mutationFn:e=>g.create(e),onSuccess:()=>{c.success("Xizmat yaratildi!"),n.invalidateQueries({queryKey:["services"]}),I(!1),i.resetFields()},onError:e=>{var r,l,o,d;console.error("Create Service Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),M=h({mutationFn:({id:e,values:s})=>g.update(e,s),onSuccess:()=>{c.success("Xizmat yangilandi!"),n.invalidateQueries({queryKey:["services"]}),I(!1),v(null),i.resetFields()},onError:e=>{var r,l,o,d;console.error("Update Service Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),J=h({mutationFn:e=>g.delete(e),onSuccess:()=>{c.success("Xizmat o'chirildi!"),n.invalidateQueries({queryKey:["services"]})},onError:e=>{var r,l,o,d;console.error("Delete Service Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),R=h({mutationFn:({id:e,file:s})=>g.uploadImage(e,s),onSuccess:e=>{c.success("Rasm yuklandi!"),n.invalidateQueries({queryKey:["services"]}),v(s=>{var r;return s&&{...s,image:(r=e.data)==null?void 0:r.image}})},onError:()=>c.error("Rasm yuklashda xatolik")}),K=h({mutationFn:e=>g.deleteImage(e),onSuccess:()=>{c.success("Rasm o'chirildi!"),n.invalidateQueries({queryKey:["services"]}),v(e=>e&&{...e,image:void 0})},onError:()=>c.error("Rasm o'chirishda xatolik")}),P=h({mutationFn:e=>g.createDetail(e),onSuccess:()=>{c.success("Tafsilot yaratildi!"),n.invalidateQueries({queryKey:["service-details"]}),w(!1),t.resetFields()},onError:e=>{var r,l,o,d;console.error("Create Service Detail Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),$=h({mutationFn:({id:e,values:s})=>g.updateDetail(e,s),onSuccess:()=>{c.success("Tafsilot yangilandi!"),n.invalidateQueries({queryKey:["service-details"]}),w(!1),b(null),t.resetFields()},onError:e=>{var r,l,o,d;console.error("Update Service Detail Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),W=h({mutationFn:e=>g.deleteDetail(e),onSuccess:()=>{c.success("Tafsilot o'chirildi!"),n.invalidateQueries({queryKey:["service-details"]})},onError:e=>{var r,l,o,d;console.error("Delete Service Detail Error:",e);const s=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.error)||((d=(o=e.response)==null?void 0:o.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";c.error(s)}}),A=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},Z=e=>{const{image:s,...r}=e;x?M.mutate({id:x.id,values:r}):N.mutate(r)},ee=e=>{if(k)$.mutate({id:k.id,values:e});else{const s=m==null?void 0:m.id;P.mutate({...e,serviceId:s})}},ae=e=>{v(e),i.setFieldsValue(e),I(!0)},te=[{title:"Icon",dataIndex:"icon",key:"icon",width:60,render:e=>a.jsx("span",{style:{fontSize:20},children:e||"ðŸ”§"})},{title:"Nomi",dataIndex:"title",key:"title"},{title:"Narx",dataIndex:"price",key:"price"},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e?a.jsx(_,{children:e.name}):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>a.jsx(_,{color:e?"green":"default",children:e?"Faol":"Nofaol"})},{title:"Tartib",dataIndex:"order",key:"order",width:80},{title:"Amallar",key:"actions",width:150,render:(e,s)=>a.jsxs(C,{children:[a.jsx(y,{size:"small",icon:a.jsx(ye,{}),onClick:()=>T(s),title:"Tafsilotlar"}),a.jsx(y,{size:"small",icon:a.jsx(Q,{}),onClick:()=>ae(s)}),a.jsx(L,{title:"O'chirishni tasdiqlaysizmi?",onConfirm:()=>J.mutate(s.id),children:a.jsx(y,{size:"small",danger:!0,icon:a.jsx(E,{})})})]})}],se=[{title:"Icon",dataIndex:"icon",key:"icon",width:60,render:e=>a.jsx("span",{style:{fontSize:18},children:e||"â€¢"})},{title:"Nomi",dataIndex:"title",key:"title"},{title:"Tavsif",dataIndex:"description",key:"description",ellipsis:!0},{title:"Tartib",dataIndex:"order",key:"order",width:80},{title:"Amallar",key:"actions",width:120,render:(e,s)=>a.jsxs(C,{children:[a.jsx(y,{size:"small",icon:a.jsx(Q,{}),onClick:()=>{b(s),t.setFieldsValue(s),w(!0)}}),a.jsx(L,{title:"O'chirish?",onConfirm:()=>W.mutate(s.id),children:a.jsx(y,{size:"small",danger:!0,icon:a.jsx(E,{})})})]})}];return a.jsxs("div",{className:"space-y-4",children:[a.jsx(oe,{title:"Xizmatlar",subtitle:"Xizmatlarni boshqarish",extra:a.jsx(y,{type:"primary",icon:a.jsx(H,{}),onClick:()=>{v(null),i.resetFields(),I(!0)},children:"Yangi xizmat"})}),a.jsx(de,{children:a.jsx(X,{columns:te,dataSource:(F==null?void 0:F.data)||[],rowKey:"id",loading:G,pagination:{pageSize:10}})}),a.jsxs(U,{open:S,onClose:()=>{I(!1),v(null),i.resetFields()},title:x?"Xizmatni yangilash":"Yangi xizmat",form:i,onSubmit:Z,loading:N.isPending||M.isPending,isEdit:!!x,children:[a.jsx(u.Item,{name:"title",label:"Nomi",rules:[{required:!0}],children:a.jsx(f,{placeholder:"Huquqiy maslahat"})}),a.jsx(u.Item,{name:"description",label:"Tavsif",children:a.jsx(f.TextArea,{rows:3,placeholder:"Professional huquqiy xizmatlar..."})}),a.jsx(u.Item,{name:"icon",label:"Icon (emoji)",children:a.jsx(f,{placeholder:"ðŸŒ"})}),x&&a.jsx(u.Item,{label:"Rasm",children:a.jsxs("div",{className:"space-y-2",children:[A(x.image)&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:A(x.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),a.jsx(y,{danger:!0,size:"small",icon:a.jsx(E,{}),onClick:()=>K.mutate(x.id),loading:K.isPending,style:{position:"absolute",top:8,right:8}})]}),a.jsx(ce,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(R.mutate({id:x.id,file:e}),!1),children:a.jsx(y,{icon:a.jsx(me,{}),loading:R.isPending,children:"Rasm yuklash"})})]})}),a.jsx(u.Item,{name:"categoryId",label:"Kategoriya",children:a.jsx(B,{placeholder:"Tanlang",allowClear:!0,children:(O=z==null?void 0:z.data)==null?void 0:O.map(e=>a.jsx(B.Option,{value:e.id,children:e.name},e.id))})}),a.jsx(u.Item,{name:"price",label:"Narx",children:a.jsx(f,{placeholder:"dan $500"})}),a.jsx(u.Item,{name:"order",label:"Tartib",children:a.jsx(Y,{min:0,className:"w-full"})}),a.jsx(u.Item,{name:"isActive",label:"Faol",valuePropName:"checked",children:a.jsx(ue,{})})]}),a.jsx(pe,{title:`${(m==null?void 0:m.title)||""} â€” Tafsilotlar`,open:!!m,onClose:()=>{T(null),b(null)},width:600,styles:{body:{padding:"16px",background:"var(--bg-card)"},header:{background:"var(--bg-card)"},content:{background:"var(--bg-card)"}},children:a.jsxs(C,{direction:"vertical",className:"w-full",size:"middle",children:[a.jsx(y,{type:"primary",icon:a.jsx(H,{}),onClick:()=>{b(null),t.resetFields(),w(!0)},children:"Yangi tafsilot"}),a.jsx(X,{columns:se,dataSource:(D==null?void 0:D.data)||[],rowKey:"id",pagination:!1,size:"small"})]})}),a.jsxs(U,{open:V,onClose:()=>{w(!1),b(null),t.resetFields()},title:k?"Tafsilotni yangilash":"Yangi tafsilot",form:t,onSubmit:ee,loading:P.isPending||$.isPending,isEdit:!!k,width:380,children:[a.jsx(u.Item,{name:"title",label:"Nomi",rules:[{required:!0}],children:a.jsx(f,{placeholder:"Shartnomalar tayyorlash"})}),a.jsx(u.Item,{name:"description",label:"Tavsif",children:a.jsx(f.TextArea,{rows:2,placeholder:"Professional shartnomalar"})}),a.jsx(u.Item,{name:"icon",label:"Icon (emoji)",children:a.jsx(f,{placeholder:"ðŸ“±"})}),a.jsx(u.Item,{name:"order",label:"Tartib",children:a.jsx(Y,{min:0,className:"w-full"})})]})]})};export{Ae as default};
