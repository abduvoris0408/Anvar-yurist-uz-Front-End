import{r as p,G as A,k as t}from"./index-F3grSWdG.js";import{u as L}from"./useClosable-uJIj1gsA.js";import{u as q,s as g}from"./index-DVxfzCL-.js";import{c as f}from"./client-CX91g6yc.js";import{C as K}from"./CrudDrawer-VwFJGtif.js";import{A as O}from"./ActionButtons-CRKm-3pF.js";import{P}from"./PageHeader-Cabh6d31.js";import{F as y}from"./index-Cv5QttRn.js";import{F as B}from"./Table-B2BAtLIv.js";import{D as l}from"./index-Bq4NAjzZ.js";import{S as x}from"./index-C7_EJlaz.js";import{I as Q}from"./index-CZbTi1p4.js";import{T as H}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./DeleteOutlined-iu_k66-Y.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./DownOutlined-Bz--1KPw.js";import"./index-Bf1aI_MO.js";const b={getAll:async n=>{const{data:s}=await f.get("/consultations",{params:n});return s},getById:async n=>{const{data:s}=await f.get(`/consultations/${n}`);return s},update:async(n,s)=>{const{data:h}=await f.put(`/consultations/${n}`,s);return h},delete:async n=>{const{data:s}=await f.delete(`/consultations/${n}`);return s}},{TextArea:X}=Q,ce=()=>{var C;const[n,s]=p.useState(!1),[h,S]=p.useState(null),[i,I]=p.useState(null),[j]=y.useForm(),N=A(),[d,M]=p.useState(""),{data:r,isLoading:z}=L({queryKey:["consultations"],queryFn:()=>b.getAll()}),D=p.useMemo(()=>r!=null&&r.data?d?r.data.filter(e=>{var a;return e.fullName.toLowerCase().includes(d.toLowerCase())||((a=e.email)==null?void 0:a.toLowerCase().includes(d.toLowerCase()))||e.phone.toLowerCase().includes(d.toLowerCase())}):r.data:[],[r==null?void 0:r.data,d]),v=q({mutationFn:({id:e,data:a})=>b.update(e,a),onSuccess:()=>{g.success("Status yangilandi"),N.invalidateQueries({queryKey:["consultations"]}),k()},onError:e=>{var o,c,m,u;console.error("Update Consultation Error:",e);const a=((c=(o=e.response)==null?void 0:o.data)==null?void 0:c.error)||((u=(m=e.response)==null?void 0:m.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";g.error(a)}}),w=q({mutationFn:e=>b.delete(e),onSuccess:()=>{g.success("So'rov o'chirildi"),N.invalidateQueries({queryKey:["consultations"]})},onError:e=>{var o,c,m,u;console.error("Delete Consultation Error:",e);const a=((c=(o=e.response)==null?void 0:o.data)==null?void 0:c.error)||((u=(m=e.response)==null?void 0:m.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";g.error(a)}}),E=e=>{S(e.id),I(e),j.setFieldsValue({status:e.status,adminNotes:e.adminNotes}),s(!0)},k=()=>{s(!1),S(null),I(null),j.resetFields()},F=e=>{h&&v.mutate({id:h,data:{status:e.status,adminNotes:e.adminNotes}})},T=[{title:"Mijoz",dataIndex:"fullName",key:"fullName",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e}),t.jsx("div",{className:"text-xs text-gray-500",children:a.phone})]})},{title:"Xizmat",dataIndex:"service",key:"service",render:e=>(e==null?void 0:e.title)||"-"},{title:"Sana",dataIndex:"preferredDate",key:"preferredDate",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{children:e||"-"}),t.jsx("div",{className:"text-xs text-gray-500",children:a.preferredTime||"-"})]})},{title:"Holat",dataIndex:"status",key:"status",render:e=>{const a={pending:"orange",confirmed:"blue",completed:"green",cancelled:"red"},o={pending:"Kutilmoqda",confirmed:"Tasdiqlandi",completed:"Yakunlandi",cancelled:"Bekor qilindi"};return t.jsx(H,{color:a[e]||"default",children:o[e]||e})}},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(O,{onEdit:()=>E(a),onDelete:()=>w.mutate(a.id),deleteLoading:w.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(P,{title:"Maslahat So'rovlari",onSearch:M,searchPlaceholder:"Mijoz ismi, telefon yoki email bo'yicha...",children:t.jsx(B,{columns:T,dataSource:D,rowKey:"id",loading:z,pagination:{pageSize:10}})}),t.jsxs(K,{title:"So'rovni ko'rish / Status o'zgartirish",open:n,onClose:k,loading:v.isPending,form:j,onSubmit:F,isEdit:!0,children:[i&&t.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-100",children:[t.jsxs(l,{column:1,size:"small",children:[t.jsx(l.Item,{label:"Mijoz",children:i.fullName}),t.jsx(l.Item,{label:"Telefon",children:i.phone}),t.jsx(l.Item,{label:"Email",children:i.email||"-"}),t.jsx(l.Item,{label:"Xizmat",children:((C=i.service)==null?void 0:C.title)||"-"}),t.jsx(l.Item,{label:"Sana",children:i.preferredDate}),t.jsx(l.Item,{label:"Vaqt",children:i.preferredTime})]}),i.message&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Xabar:"}),t.jsx("div",{className:"text-sm",children:i.message})]})]}),t.jsx(y.Item,{name:"status",label:"Holati",rules:[{required:!0,message:"Statusni tanlang"}],children:t.jsxs(x,{children:[t.jsx(x.Option,{value:"pending",children:"Kutilmoqda"}),t.jsx(x.Option,{value:"confirmed",children:"Tasdiqlandi"}),t.jsx(x.Option,{value:"completed",children:"Yakunlandi"}),t.jsx(x.Option,{value:"cancelled",children:"Bekor qilindi"})]})}),t.jsx(y.Item,{name:"adminNotes",label:"Admin izohi",children:t.jsx(X,{rows:4,placeholder:"Izoh yoki eslatma yozing..."})})]})]})};export{ce as default};
