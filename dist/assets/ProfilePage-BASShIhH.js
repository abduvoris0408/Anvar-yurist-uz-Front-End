import{n as M,r as N,k as e,B as l}from"./index-isBeRo1b.js";import{T as S,b as z,C as R}from"./client-D49sAvGJ.js";import{R as F,a as d}from"./auth-C9e6dK8c.js";import{u as m,s as o}from"./index-DOY2cXOq.js";import{P as T}from"./PageHeader-CzhsRgKs.js";import{F as t}from"./index-CO1TAYVF.js";import{C as f}from"./index-CUCRgLKV.js";import{A as B}from"./index-DFmE7rub.js";import{R as U}from"./UserOutlined-ZZX18Gmx.js";import{U as c,R as q}from"./UploadOutlined-C9sZaBMJ.js";import{R as J}from"./DeleteOutlined-BdlBkdV1.js";import{I as n}from"./index-BiEyZbEs.js";import{R as L}from"./SaveOutlined-CJyv-XiG.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./QuestionCircleOutlined-DwuYyw29.js";const{Title:O,Text:C}=S,{TextArea:Y}=n,ie=()=>{const{user:a,setUser:u}=M(),[p]=t.useForm(),[j]=t.useForm(),[y,h]=N.useState(void 0),x=s=>{u&&typeof u=="function"&&u(s)};N.useEffect(()=>{a&&(p.setFieldsValue({name:a.name,email:a.email,bio:a.bio}),h(A(a.avatar)))},[a,p]);const A=s=>{if(s)return typeof s=="string"?s:s.url},g=m({mutationFn:s=>d.uploadAvatar(s),onSuccess:s=>{if(o.success("Profil rasmi yangilandi"),a){const r=s.data,i={...a,avatar:r};x(i),h(r.url)}},onError:s=>{var r,i;o.error(((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Rasm yuklashda xatolik")}}),P=m({mutationFn:()=>d.deleteAvatar(),onSuccess:()=>{if(o.success("Profil rasmi o'chirildi"),a){const s={...a,avatar:void 0};x(s),h(void 0)}},onError:s=>{var r,i;o.error(((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Rasm o'chirishda xatolik")}}),w=m({mutationFn:s=>d.updateDetails(s),onSuccess:s=>{o.success("Ma'lumotlar saqlandi"),x(s.data)},onError:s=>{var r,i;o.error(((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Ma'lumotlarni saqlashda xatolik")}}),b=m({mutationFn:s=>d.updatePassword(s),onSuccess:()=>{o.success("Parol yangilandi!"),j.resetFields()},onError:s=>{var r,i,I,k;o.error(((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||((k=(I=s.response)==null?void 0:I.data)==null?void 0:k.message)||"Joriy parol noto'g'ri")}}),v=s=>s.type==="image/jpeg"||s.type==="image/png"||s.type==="image/webp"?s.size/1024/1024<2?(g.mutate(s),!1):(o.error("Rasm hajmi 2MB dan kichik bo'lishi kerak!"),c.LIST_IGNORE):(o.error("Faqat JPG/PNG/WEBP fayllarni yuklashingiz mumkin!"),c.LIST_IGNORE),E=s=>{if(s.newPassword!==s.confirmPassword){o.error("Parollar mos kelmadi!");return}b.mutate({currentPassword:s.currentPassword,newPassword:s.newPassword})};return e.jsx(T,{title:"Profil Sozlamalari",children:e.jsxs("div",{className:"mx-auto",children:[e.jsx(f,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(B,{size:120,icon:e.jsx(U,{}),src:y,className:"border-4 border-indigo-100"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(c,{showUploadList:!1,beforeUpload:v,accept:"image/*",children:e.jsx(l,{type:"text",icon:e.jsx(q,{}),className:"text-white hover:text-white",loading:g.isPending,children:"Yuklash"})})})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx(O,{level:4,className:"!mb-0",children:a==null?void 0:a.name}),e.jsx(C,{type:"secondary",children:a==null?void 0:a.email}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center md:justify-start gap-3",children:[e.jsx(c,{showUploadList:!1,beforeUpload:v,accept:"image/*",children:e.jsx(l,{icon:e.jsx(q,{}),loading:g.isPending,children:"Rasm yuklash"})}),y&&e.jsx(l,{danger:!0,icon:e.jsx(J,{}),onClick:()=>P.mutate(),loading:P.isPending,children:"O'chirish"})]})]})]})}),e.jsxs(z,{gutter:[24,24],children:[e.jsx(R,{xs:24,lg:12,children:e.jsx(f,{title:"Shaxsiy Ma'lumotlar",className:"h-full",children:e.jsxs(t,{form:p,layout:"vertical",onFinish:s=>w.mutate(s),children:[e.jsx(t.Item,{name:"name",label:"Ism",rules:[{required:!0,message:"Ismingizni kiriting"}],children:e.jsx(n,{prefix:e.jsx(U,{className:"text-gray-400"})})}),e.jsx(t.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Emailingizni kiriting"},{type:"email",message:"To'g'ri email kiriting"}],children:e.jsx(n,{})}),e.jsx(t.Item,{name:"bio",label:"Bio",children:e.jsx(Y,{rows:4,placeholder:"O'zingiz haqingizda qisqacha"})}),e.jsx(t.Item,{className:"mb-0 text-right",children:e.jsx(l,{type:"primary",htmlType:"submit",icon:e.jsx(L,{}),loading:w.isPending,children:"Saqlash"})})]})})}),e.jsx(R,{xs:24,lg:12,children:e.jsx(f,{title:e.jsxs(e.Fragment,{children:[e.jsx(F,{})," Parolni o'zgartirish"]}),className:"h-full",children:e.jsxs(t,{form:j,layout:"vertical",onFinish:E,children:[e.jsx(t.Item,{name:"currentPassword",label:"Joriy parol",rules:[{required:!0}],children:e.jsx(n.Password,{placeholder:"Joriy parol"})}),e.jsx(t.Item,{name:"newPassword",label:"Yangi parol",rules:[{required:!0,min:6}],children:e.jsx(n.Password,{placeholder:"Yangi parol"})}),e.jsx(t.Item,{name:"confirmPassword",label:"Yangi parolni tasdiqlash",rules:[{required:!0}],children:e.jsx(n.Password,{placeholder:"Yangi parolni tasdiqlang"})}),e.jsx(t.Item,{className:"mb-0 text-right",children:e.jsx(l,{type:"primary",htmlType:"submit",icon:e.jsx(F,{}),loading:b.isPending,children:"Parolni yangilash"})})]})})})]})]})})};export{ie as default};
