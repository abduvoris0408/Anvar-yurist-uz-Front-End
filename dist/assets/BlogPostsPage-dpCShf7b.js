import{G as X,r as S,k as a,B as g}from"./index-F3grSWdG.js";import{u as R}from"./useClosable-uJIj1gsA.js";import{u as x,s as i}from"./index-DVxfzCL-.js";import{R as _,j as J}from"./client-CX91g6yc.js";import{b as m}from"./blog-GSkI9Esz.js";import{t as W}from"./tags-CzfaenlO.js";import{c as Z}from"./categories-C0Tbv_kI.js";import{C as ee}from"./CrudDrawer-VwFJGtif.js";import{P as ae}from"./PageHeader-Cabh6d31.js";import{d as te}from"./dayjs.min-DsquTRpG.js";import{F as r}from"./index-Cv5QttRn.js";import{S as j,R as se,C as ie}from"./index-lsxE6RmN.js";import{S as n,P as A}from"./index-C7_EJlaz.js";import{F as re}from"./Table-B2BAtLIv.js";import{I as k}from"./index-CZbTi1p4.js";import{R as O}from"./DeleteOutlined-iu_k66-Y.js";import{U as oe,R as le}from"./UploadOutlined-C8kOzndP.js";import{T as F}from"./index-DLxPakHX.js";import{S as Q}from"./index-DEZQ1x4x.js";import{R as T}from"./StarOutlined-Vhy6f5ck.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./DownOutlined-Bz--1KPw.js";import"./index-Bf1aI_MO.js";const{TextArea:w}=k,Be=()=>{var B,K;const[u]=r.useForm(),p=X(),[z,y]=S.useState(!1),[l,h]=S.useState(null),[f,N]=S.useState(""),{data:b,isLoading:$}=R({queryKey:["blog-posts",f],queryFn:()=>m.getAll(f?{status:f}:void 0)}),{data:v}=R({queryKey:["categories"],queryFn:()=>Z.getAll()}),{data:I}=R({queryKey:["tags"],queryFn:()=>W.getAll()}),C=x({mutationFn:e=>m.create(e),onSuccess:()=>{i.success("Blog post yaratildi!"),p.invalidateQueries({queryKey:["blog-posts"]}),y(!1),u.resetFields()},onError:e=>{var s,o,d,c;console.error("Create Blog Post Error:",e);const t=((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";i.error(t)}}),q=x({mutationFn:({id:e,values:t})=>m.update(e,t),onSuccess:()=>{i.success("Blog post yangilandi!"),p.invalidateQueries({queryKey:["blog-posts"]}),y(!1),h(null),u.resetFields()},onError:e=>{var s,o,d,c;console.error("Update Blog Post Error:",e);const t=((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";i.error(t)}}),U=x({mutationFn:e=>m.delete(e),onSuccess:()=>{i.success("Blog post o'chirildi!"),p.invalidateQueries({queryKey:["blog-posts"]})},onError:e=>{var s,o,d,c;console.error("Delete Blog Post Error:",e);const t=((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";i.error(t)}}),P=x({mutationFn:({id:e,file:t})=>m.uploadImage(e,t),onSuccess:e=>{i.success("Rasm yuklandi!"),p.invalidateQueries({queryKey:["blog-posts"]}),h(t=>{var s;return t&&{...t,image:(s=e.data)==null?void 0:s.image}})},onError:()=>i.error("Rasm yuklashda xatolik")}),E=x({mutationFn:e=>m.deleteImage(e),onSuccess:()=>{i.success("Rasm o'chirildi!"),p.invalidateQueries({queryKey:["blog-posts"]}),h(e=>e&&{...e,image:void 0})},onError:()=>i.error("Rasm o'chirishda xatolik")}),Y=x({mutationFn:e=>m.deleteRatings(e),onSuccess:()=>{i.success("Reytinglar tozalandi!"),p.invalidateQueries({queryKey:["blog-posts"]})},onError:()=>i.error("Xatolik yuz berdi")}),M=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},D=e=>{const{image:t,...s}=e;l?q.mutate({id:l.id,values:s}):C.mutate(s)},L=e=>{var t,s;h(e),u.setFieldsValue({...e,categoryId:e.categoryId||((t=e.category)==null?void 0:t.id),tags:(s=e.tags)==null?void 0:s.map(o=>o.id)}),y(!0)},V={published:"green",draft:"orange",archived:"default"},H={published:"Chop etilgan",draft:"Qoralama",archived:"Arxiv"},G=[{title:"Sarlavha",dataIndex:"title",key:"title",ellipsis:!0,render:(e,t)=>a.jsxs(j,{children:[a.jsx("span",{children:e}),t.isFeatured&&a.jsx(T,{style:{color:"#f59e0b"}})]})},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e?a.jsx(F,{color:e.color,children:e.name}):"-"},{title:"Status",dataIndex:"status",key:"status",render:e=>a.jsx(F,{color:V[e],children:H[e]||e})},{title:"Ko'rishlar",dataIndex:"views",key:"views",width:100,render:e=>a.jsxs(j,{children:[a.jsx(_,{}),e||0]})},{title:"Reyting",dataIndex:"averageRating",key:"averageRating",width:120,render:(e,t)=>e?`â­ ${e.toFixed(1)} (${t.totalRatings})`:"-"},{title:"O'qish vaqti",dataIndex:"readTime",key:"readTime",width:100,render:e=>e?`${e} min`:"-"},{title:"Sana",dataIndex:"createdAt",key:"createdAt",width:120,render:e=>te(e).format("DD.MM.YYYY")},{title:"Amallar",key:"actions",width:150,render:(e,t)=>a.jsxs(j,{children:[a.jsx(g,{size:"small",icon:a.jsx(J,{}),onClick:()=>L(t)}),(t.totalRatings||0)>0&&a.jsx(A,{title:"Reytinglarni tozalash?",onConfirm:()=>Y.mutate(t.id),children:a.jsx(g,{size:"small",icon:a.jsx(T,{}),title:"Reytingni tozalash"})}),a.jsx(A,{title:"O'chirishni tasdiqlaysizmi?",onConfirm:()=>U.mutate(t.id),children:a.jsx(g,{size:"small",danger:!0,icon:a.jsx(O,{})})})]})}];return a.jsxs("div",{className:"space-y-4",children:[a.jsx(ae,{title:"Blog Postlar",subtitle:"Blog maqolalarni boshqarish",extra:a.jsxs(j,{children:[a.jsx(n,{placeholder:"Status bo'yicha",allowClear:!0,style:{width:160},onChange:e=>N(e||""),options:[{value:"published",label:"Chop etilgan"},{value:"draft",label:"Qoralama"},{value:"archived",label:"Arxiv"}]}),a.jsx(g,{type:"primary",icon:a.jsx(se,{}),onClick:()=>{h(null),u.resetFields(),y(!0)},children:"Yangi post"})]})}),a.jsx(ie,{children:a.jsx(re,{columns:G,dataSource:(b==null?void 0:b.data)||[],rowKey:"id",loading:$,pagination:{pageSize:10}})}),a.jsxs(ee,{open:z,onClose:()=>{y(!1),h(null),u.resetFields()},title:l?"Blog postni yangilash":"Yangi blog post",form:u,onSubmit:D,loading:C.isPending||q.isPending,isEdit:!!l,width:520,children:[a.jsx(r.Item,{name:"title",label:"Sarlavha",rules:[{required:!0}],children:a.jsx(k,{placeholder:"Fuqarolik ishlarida himoya"})}),a.jsx(r.Item,{name:"excerpt",label:"Qisqa tavsif",children:a.jsx(w,{rows:2,placeholder:"Bu maqolada..."})}),a.jsx(r.Item,{name:"content",label:"Content (HTML)",children:a.jsx(w,{rows:8,placeholder:"<h2>Kirish</h2><p>Bu maqolada...</p>"})}),l&&a.jsx(r.Item,{label:"Cover rasm",children:a.jsxs("div",{className:"space-y-2",children:[M(l.image)&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:M(l.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),a.jsx(g,{danger:!0,size:"small",icon:a.jsx(O,{}),onClick:()=>E.mutate(l.id),loading:E.isPending,style:{position:"absolute",top:8,right:8}})]}),a.jsx(oe,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(P.mutate({id:l.id,file:e}),!1),children:a.jsx(g,{icon:a.jsx(le,{}),loading:P.isPending,children:"Rasm yuklash"})})]})}),a.jsx(r.Item,{name:"categoryId",label:"Kategoriya",children:a.jsx(n,{placeholder:"Tanlang",allowClear:!0,children:(B=v==null?void 0:v.data)==null?void 0:B.map(e=>a.jsx(n.Option,{value:e.id,children:e.name},e.id))})}),a.jsx(r.Item,{name:"tags",label:"Teglar",children:a.jsx(n,{mode:"multiple",placeholder:"Teglarni tanlang",allowClear:!0,children:(K=I==null?void 0:I.data)==null?void 0:K.map(e=>a.jsx(n.Option,{value:e.id,children:a.jsx(F,{color:e.color,children:e.name})},e.id))})}),a.jsx(r.Item,{name:"status",label:"Status",initialValue:"draft",children:a.jsxs(n,{children:[a.jsx(n.Option,{value:"draft",children:"Qoralama"}),a.jsx(n.Option,{value:"published",children:"Chop etish"}),a.jsx(n.Option,{value:"archived",children:"Arxivlash"})]})}),a.jsx(r.Item,{name:"isFeatured",label:"Featured",valuePropName:"checked",children:a.jsx(Q,{})}),a.jsx(r.Item,{name:"allowComments",label:"Izohga ruxsat",valuePropName:"checked",initialValue:!0,children:a.jsx(Q,{})}),a.jsx(r.Item,{name:"metaTitle",label:"Meta Title (SEO)",children:a.jsx(k,{placeholder:"SEO sarlavha"})}),a.jsx(r.Item,{name:"metaDescription",label:"Meta Description (SEO)",children:a.jsx(w,{rows:2,placeholder:"SEO tavsif"})})]})]})};export{Be as default};
