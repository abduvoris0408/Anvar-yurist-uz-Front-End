import{r as j,G as R,k as t,B as E}from"./index-F3grSWdG.js";import{u as U}from"./useClosable-uJIj1gsA.js";import{u as k,s as n}from"./index-DVxfzCL-.js";import{c as m}from"./client-CX91g6yc.js";import{C as Q}from"./CrudDrawer-VwFJGtif.js";import{A as $}from"./ActionButtons-CRKm-3pF.js";import{P as B}from"./PageHeader-Cabh6d31.js";import{F as p}from"./index-Cv5QttRn.js";import{F as V}from"./Table-B2BAtLIv.js";import{I as F}from"./index-CZbTi1p4.js";import{R as z}from"./DeleteOutlined-iu_k66-Y.js";import{U as O,R as Y}from"./UploadOutlined-C8kOzndP.js";import{T as _}from"./index-MhhX0jA_.js";import{S as G}from"./index-DEZQ1x4x.js";import{A as J}from"./index-D6kZoG9a.js";import{T as W}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./index-C7_EJlaz.js";import"./DownOutlined-Bz--1KPw.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./index-Bf1aI_MO.js";const g={getAll:async o=>{const{data:r}=await m.get("/partners",{params:o});return r},getById:async o=>{const{data:r}=await m.get(`/partners/${o}`);return r},create:async o=>{const{data:r}=await m.post("/partners",o);return r},update:async(o,r)=>{const{data:i}=await m.put(`/partners/${o}`,r);return i},delete:async o=>{const{data:r}=await m.delete(`/partners/${o}`);return r},uploadLogo:async(o,r)=>{const i=new FormData;i.append("logo",r);const{data:h}=await m.put(`/partners/${o}/logo`,i,{headers:{"Content-Type":"multipart/form-data"}});return h},deleteLogo:async o=>{const{data:r}=await m.delete(`/partners/${o}/logo`);return r}},{TextArea:X}=F,Le=()=>{const[o,r]=j.useState(!1),[i,h]=j.useState(null),[x,y]=j.useState(null),[w]=p.useForm(),f=R(),[L,N]=j.useState(""),{data:l,isLoading:A}=U({queryKey:["partners"],queryFn:()=>g.getAll()}),H=j.useMemo(()=>l!=null&&l.data?L?l.data.filter(e=>{var a;return e.name.toLowerCase().includes(L.toLowerCase())||((a=e.url)==null?void 0:a.toLowerCase().includes(L.toLowerCase()))}):l.data:[],[l==null?void 0:l.data,L]),S=k({mutationFn:e=>g.create(e),onSuccess:()=>{n.success("Hamkor yaratildi"),f.invalidateQueries({queryKey:["partners"]}),b()},onError:e=>{var s,d,c,u;console.error("Create Partner Error:",e);const a=((d=(s=e.response)==null?void 0:s.data)==null?void 0:d.error)||((u=(c=e.response)==null?void 0:c.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";n.error(a)}}),q=k({mutationFn:({id:e,data:a})=>g.update(e,a),onSuccess:()=>{n.success("Hamkor yangilandi"),f.invalidateQueries({queryKey:["partners"]}),b()},onError:e=>{var s,d,c,u;console.error("Update Partner Error:",e);const a=((d=(s=e.response)==null?void 0:s.data)==null?void 0:d.error)||((u=(c=e.response)==null?void 0:c.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";n.error(a)}}),C=k({mutationFn:e=>g.delete(e),onSuccess:()=>{n.success("Hamkor o'chirildi"),f.invalidateQueries({queryKey:["partners"]})},onError:e=>{var s,d,c,u;console.error("Delete Partner Error:",e);const a=((d=(s=e.response)==null?void 0:s.data)==null?void 0:d.error)||((u=(c=e.response)==null?void 0:c.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";n.error(a)}}),P=k({mutationFn:({id:e,file:a})=>g.uploadLogo(e,a),onSuccess:e=>{n.success("Logo yuklandi!"),f.invalidateQueries({queryKey:["partners"]}),y(a=>{var s;return a&&{...a,logo:(s=e.data)==null?void 0:s.logo}})},onError:()=>n.error("Logo yuklashda xatolik")}),v=k({mutationFn:e=>g.deleteLogo(e),onSuccess:()=>{n.success("Logo o'chirildi!"),f.invalidateQueries({queryKey:["partners"]}),y(e=>e&&{...e,logo:void 0})},onError:()=>n.error("Logo o'chirishda xatolik")}),T=()=>{h(null),y(null),w.resetFields(),r(!0)},M=e=>{h(e.id),y(e),w.setFieldsValue(e),r(!0)},b=()=>{r(!1),h(null),y(null),w.resetFields()},D=e=>{const{logo:a,...s}=e;i?q.mutate({id:i,data:s}):S.mutate(s)},I=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},K=[{title:"Logo",dataIndex:"logo",key:"logo",render:e=>{const a=I(e);return t.jsx(J,{src:a,shape:"square",size:"large"})}},{title:"Nomi",dataIndex:"name",key:"name",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e}),a.description&&t.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:a.description})]})},{title:"Veb-sayt",dataIndex:"url",key:"url",render:e=>e?t.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e}):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>t.jsx(W,{color:e?"green":"red",children:e?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx($,{onEdit:()=>M(a),onDelete:()=>C.mutate(a.id),deleteLoading:C.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(B,{title:"Hamkorlar",onAdd:T,addButtonText:"Yangi hamkor",onSearch:N,searchPlaceholder:"Hamkor nomi yoki URL bo'yicha qidirish...",children:t.jsx(V,{columns:K,dataSource:H,rowKey:"id",loading:A,pagination:{pageSize:10}})}),t.jsxs(Q,{title:i?"Hamkorni tahrirlash":"Yangi hamkor qo'shish",open:o,onClose:b,loading:S.isPending||q.isPending,form:w,onSubmit:D,isEdit:!!i,children:[t.jsx(p.Item,{name:"name",label:"Hamkor Nomi",rules:[{required:!0,message:"Hamkor nomini kiriting"}],children:t.jsx(F,{placeholder:"Kompaniya nomi"})}),t.jsx(p.Item,{name:"url",label:"Veb-sayt URL",children:t.jsx(F,{placeholder:"https://company.com"})}),x&&t.jsx(p.Item,{label:"Logo",children:t.jsxs("div",{className:"space-y-2",children:[I(x.logo)&&t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:I(x.logo),alt:"Logo",style:{width:80,height:80,objectFit:"contain",borderRadius:8,border:"1px solid #eee"}}),t.jsx(E,{danger:!0,size:"small",icon:t.jsx(z,{}),onClick:()=>v.mutate(x.id),loading:v.isPending,style:{position:"absolute",top:-8,right:-8}})]}),t.jsx(O,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(P.mutate({id:x.id,file:e}),!1),children:t.jsx(E,{icon:t.jsx(Y,{}),loading:P.isPending,children:"Logo yuklash"})})]})}),t.jsx(p.Item,{name:"description",label:"Tavsif",children:t.jsx(X,{rows:3,placeholder:"Hamkor haqida qisqacha..."})}),t.jsx(p.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:t.jsx(_,{min:1,className:"w-full"})}),t.jsx(p.Item,{name:"isActive",label:"Holati",valuePropName:"checked",initialValue:!0,children:t.jsx(G,{checkedChildren:"Faol",unCheckedChildren:"Nofaol"})})]})]})};export{Le as default};
