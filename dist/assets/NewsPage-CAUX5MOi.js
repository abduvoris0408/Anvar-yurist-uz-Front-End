import{r as I,I as _,_ as B,G as D,k as a,B as f}from"./index-isBeRo1b.js";import{u as S}from"./useClosable-Dwegbn33.js";import{u as j,s as o}from"./index-DOY2cXOq.js";import{c as p,R as H,j as V}from"./client-D49sAvGJ.js";import{t as G}from"./tags-CgsCyJyh.js";import{c as J}from"./categories--hKE1BeI.js";import{C as W}from"./CrudDrawer-CCohrQdE.js";import{P as X}from"./PageHeader-CzhsRgKs.js";import{d as Z}from"./dayjs.min-D51Aj4CE.js";import{F as n}from"./index-CO1TAYVF.js";import{R as ee,C as ae,S as F}from"./index-CUCRgLKV.js";import{F as te}from"./Table-CbaHfp0x.js";import{I as w}from"./index-BiEyZbEs.js";import{R as Y}from"./DeleteOutlined-BdlBkdV1.js";import{U as se,R as re}from"./UploadOutlined-C9sZaBMJ.js";import{S as g,P as ie}from"./index-DeMcSX5K.js";import{T as C}from"./index-CDKBTdtS.js";import{S as ne}from"./index-Aatx205e.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./DownOutlined-C7Jp90Yl.js";import"./index-Dh7qLhW3.js";var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},oe=function(s,c){return I.createElement(_,B({},s,{ref:c,icon:le}))},de=I.forwardRef(oe);const y={getAll:async t=>{const{data:s}=await p.get("/news",{params:t});return s},getById:async t=>{const{data:s}=await p.get(`/news/${t}`);return s},getBySlug:async t=>{const{data:s}=await p.get(`/news/slug/${t}`);return s},create:async t=>{const{data:s}=await p.post("/news",t);return s},update:async(t,s)=>{const{data:c}=await p.put(`/news/${t}`,s);return c},delete:async t=>{const{data:s}=await p.delete(`/news/${t}`);return s},uploadImage:async(t,s)=>{const c=new FormData;c.append("image",s);const{data:h}=await p.put(`/news/${t}/image`,c,{headers:{"Content-Type":"multipart/form-data"}});return h},deleteImage:async t=>{const{data:s}=await p.delete(`/news/${t}/image`);return s}},{TextArea:K}=w,Ae=()=>{var A,N;const[t]=n.useForm(),s=D(),[c,h]=I.useState(!1),[d,x]=I.useState(null),{data:k,isLoading:$}=S({queryKey:["news"],queryFn:()=>y.getAll()}),{data:v}=S({queryKey:["categories"],queryFn:()=>J.getAll()}),{data:b}=S({queryKey:["tags"],queryFn:()=>G.getAll()}),R=j({mutationFn:e=>y.create(e),onSuccess:()=>{o.success("Yangilik yaratildi!"),s.invalidateQueries({queryKey:["news"]}),h(!1),t.resetFields()},onError:e=>{var i,l,u,m;console.error("Create News Error:",e);const r=((l=(i=e.response)==null?void 0:i.data)==null?void 0:l.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(r)}}),M=j({mutationFn:({id:e,values:r})=>y.update(e,r),onSuccess:()=>{o.success("Yangilik yangilandi!"),s.invalidateQueries({queryKey:["news"]}),h(!1),x(null),t.resetFields()},onError:e=>{var i,l,u,m;console.error("Update News Error:",e);const r=((l=(i=e.response)==null?void 0:i.data)==null?void 0:l.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(r)}}),O=j({mutationFn:e=>y.delete(e),onSuccess:()=>{o.success("Yangilik o'chirildi!"),s.invalidateQueries({queryKey:["news"]})},onError:e=>{var i,l,u,m;console.error("Delete News Error:",e);const r=((l=(i=e.response)==null?void 0:i.data)==null?void 0:l.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(r)}}),q=j({mutationFn:({id:e,file:r})=>y.uploadImage(e,r),onSuccess:e=>{o.success("Rasm yuklandi!"),s.invalidateQueries({queryKey:["news"]}),x(r=>{var i;return r&&{...r,image:(i=e.data)==null?void 0:i.image}})},onError:()=>o.error("Rasm yuklashda xatolik")}),E=j({mutationFn:e=>y.deleteImage(e),onSuccess:()=>{o.success("Rasm o'chirildi!"),s.invalidateQueries({queryKey:["news"]}),x(e=>e&&{...e,image:void 0})},onError:()=>o.error("Rasm o'chirishda xatolik")}),L=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},P=e=>{const{image:r,...i}=e;d?M.mutate({id:d.id,values:i}):R.mutate(i)},Q=e=>{var r,i;x(e),t.setFieldsValue({...e,categoryId:e.categoryId||((r=e.category)==null?void 0:r.id),tags:(i=e.tags)==null?void 0:i.map(l=>l.id)}),h(!0)},T={published:"green",draft:"orange",archived:"default"},U={published:"Chop etilgan",draft:"Qoralama",archived:"Arxiv"},z=[{title:"Sarlavha",dataIndex:"title",key:"title",ellipsis:!0},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e?a.jsx(C,{color:e.color,children:e.name}):"-"},{title:"Manba",dataIndex:"source",key:"source",render:(e,r)=>e?a.jsxs(F,{children:[e,r.sourceUrl&&a.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",children:a.jsx(de,{})})]}):"-"},{title:"Status",dataIndex:"status",key:"status",render:e=>a.jsx(C,{color:T[e],children:U[e]})},{title:"Ko'rishlar",dataIndex:"views",key:"views",width:100,render:e=>a.jsxs(F,{children:[a.jsx(H,{}),e||0]})},{title:"Sana",dataIndex:"createdAt",key:"createdAt",width:120,render:e=>Z(e).format("DD.MM.YYYY")},{title:"Amallar",key:"actions",width:120,render:(e,r)=>a.jsxs(F,{children:[a.jsx(f,{size:"small",icon:a.jsx(V,{}),onClick:()=>Q(r)}),a.jsx(ie,{title:"O'chirishni tasdiqlaysizmi?",onConfirm:()=>O.mutate(r.id),children:a.jsx(f,{size:"small",danger:!0,icon:a.jsx(Y,{})})})]})}];return a.jsxs("div",{className:"space-y-4",children:[a.jsx(X,{title:"Yangiliklar",subtitle:"Yangiliklarni boshqarish",extra:a.jsx(f,{type:"primary",icon:a.jsx(ee,{}),onClick:()=>{x(null),t.resetFields(),h(!0)},children:"Yangi yangilik"})}),a.jsx(ae,{children:a.jsx(te,{columns:z,dataSource:(k==null?void 0:k.data)||[],rowKey:"id",loading:$,pagination:{pageSize:10}})}),a.jsxs(W,{open:c,onClose:()=>{h(!1),x(null),t.resetFields()},title:d?"Yangilikni yangilash":"Yangi yangilik",form:t,onSubmit:P,loading:R.isPending||M.isPending,isEdit:!!d,width:520,children:[a.jsx(n.Item,{name:"title",label:"Sarlavha",rules:[{required:!0}],children:a.jsx(w,{placeholder:"Yangi texnologiya trendi"})}),a.jsx(n.Item,{name:"excerpt",label:"Qisqa tavsif",children:a.jsx(K,{rows:2,placeholder:"Qisqa tavsif..."})}),a.jsx(n.Item,{name:"content",label:"Content (HTML)",children:a.jsx(K,{rows:6,placeholder:"<p>Maqola matni...</p>"})}),d&&a.jsx(n.Item,{label:"Rasm",children:a.jsxs("div",{className:"space-y-2",children:[L(d.image)&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:L(d.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),a.jsx(f,{danger:!0,size:"small",icon:a.jsx(Y,{}),onClick:()=>E.mutate(d.id),loading:E.isPending,style:{position:"absolute",top:8,right:8}})]}),a.jsx(se,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(q.mutate({id:d.id,file:e}),!1),children:a.jsx(f,{icon:a.jsx(re,{}),loading:q.isPending,children:"Rasm yuklash"})})]})}),a.jsx(n.Item,{name:"categoryId",label:"Kategoriya",children:a.jsx(g,{placeholder:"Tanlang",allowClear:!0,children:(A=v==null?void 0:v.data)==null?void 0:A.map(e=>a.jsx(g.Option,{value:e._id||e.id,children:e.name},e._id||e.id))})}),a.jsx(n.Item,{name:"tags",label:"Teglar",children:a.jsx(g,{mode:"multiple",placeholder:"Teglarni tanlang",allowClear:!0,children:(N=b==null?void 0:b.data)==null?void 0:N.map(e=>a.jsx(g.Option,{value:e.id,children:a.jsx(C,{color:e.color,children:e.name})},e.id))})}),a.jsx(n.Item,{name:"source",label:"Manba nomi",children:a.jsx(w,{placeholder:"TechCrunch"})}),a.jsx(n.Item,{name:"sourceUrl",label:"Manba URL",children:a.jsx(w,{placeholder:"https://techcrunch.com/..."})}),a.jsx(n.Item,{name:"status",label:"Status",initialValue:"draft",children:a.jsxs(g,{children:[a.jsx(g.Option,{value:"draft",children:"Qoralama"}),a.jsx(g.Option,{value:"published",children:"Chop etish"}),a.jsx(g.Option,{value:"archived",children:"Arxivlash"})]})}),a.jsx(n.Item,{name:"isFeatured",label:"Featured",valuePropName:"checked",children:a.jsx(ne,{})})]})]})};export{Ae as default};
