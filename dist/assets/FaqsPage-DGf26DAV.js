import{r as y,G as L,k as a}from"./index-F3grSWdG.js";import{u as I}from"./useClosable-uJIj1gsA.js";import{u as w,s as m}from"./index-DVxfzCL-.js";import{c as p}from"./client-CX91g6yc.js";import{c as J}from"./categories-C0Tbv_kI.js";import{C as B}from"./CrudDrawer-VwFJGtif.js";import{A as H}from"./ActionButtons-CRKm-3pF.js";import{P as O}from"./PageHeader-Cabh6d31.js";import{F as c}from"./index-Cv5QttRn.js";import{F as V}from"./Table-B2BAtLIv.js";import{I as _}from"./index-CZbTi1p4.js";import{S as k}from"./index-C7_EJlaz.js";import{T as $}from"./index-MhhX0jA_.js";import{S as Y}from"./index-DEZQ1x4x.js";import{T as C}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./DeleteOutlined-iu_k66-Y.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./DownOutlined-Bz--1KPw.js";import"./index-Bf1aI_MO.js";const f={getAll:async s=>{const{data:t}=await p.get("/faqs",{params:s});return t},getById:async s=>{const{data:t}=await p.get(`/faqs/${s}`);return t},create:async s=>{const{data:t}=await p.post("/faqs",s);return t},update:async(s,t)=>{const{data:u}=await p.put(`/faqs/${s}`,t);return u},delete:async s=>{const{data:t}=await p.delete(`/faqs/${s}`);return t}},{TextArea:E}=_,he=()=>{var A;const[s,t]=y.useState(!1),[u,x]=y.useState(null),[g]=c.useForm(),q=L(),[h,T]=y.useState(""),{data:o,isLoading:K}=I({queryKey:["faqs"],queryFn:()=>f.getAll()}),{data:v}=I({queryKey:["categories"],queryFn:()=>J.getAll()}),M=y.useMemo(()=>o!=null&&o.data?h?o.data.filter(e=>e.question.toLowerCase().includes(h.toLowerCase())||e.answer.toLowerCase().includes(h.toLowerCase())):o.data:[],[o==null?void 0:o.data,h]),j=w({mutationFn:e=>f.create(e),onSuccess:()=>{m.success("Savol-javob yaratildi"),q.invalidateQueries({queryKey:["faqs"]}),S()},onError:e=>{var i,n,l,d;console.error("Create FAQ Error:",e);const r=((n=(i=e.response)==null?void 0:i.data)==null?void 0:n.error)||((d=(l=e.response)==null?void 0:l.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";m.error(r)}}),F=w({mutationFn:({id:e,data:r})=>f.update(e,r),onSuccess:()=>{m.success("Savol-javob yangilandi"),q.invalidateQueries({queryKey:["faqs"]}),S()},onError:e=>{var i,n,l,d;console.error("Update FAQ Error:",e);const r=((n=(i=e.response)==null?void 0:i.data)==null?void 0:n.error)||((d=(l=e.response)==null?void 0:l.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";m.error(r)}}),b=w({mutationFn:e=>f.delete(e),onSuccess:()=>{m.success("Savol-javob o'chirildi"),q.invalidateQueries({queryKey:["faqs"]})},onError:e=>{var i,n,l,d;console.error("Delete FAQ Error:",e);const r=((n=(i=e.response)==null?void 0:i.data)==null?void 0:n.error)||((d=(l=e.response)==null?void 0:l.data)==null?void 0:d.message)||e.message||"Noma'lum xatolik";m.error(r)}}),Q=()=>{x(null),g.resetFields(),t(!0)},N=e=>{x(e.id),g.setFieldsValue(e),t(!0)},S=()=>{t(!1),x(null),g.resetFields()},P=e=>{u?F.mutate({id:u,data:e}):j.mutate(e)},D=[{title:"Savol",dataIndex:"question",key:"question",ellipsis:!0},{title:"Javob",dataIndex:"answer",key:"answer",ellipsis:!0},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e!=null&&e.name?a.jsx(C,{children:e.name}):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>a.jsx(C,{color:e?"green":"red",children:e?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(e,r)=>a.jsx(H,{onEdit:()=>N(r),onDelete:()=>b.mutate(r.id),deleteLoading:b.isPending})}];return a.jsxs(a.Fragment,{children:[a.jsx(O,{title:"FAQ (Savol-Javoblar)",onAdd:Q,addButtonText:"Yangi savol",onSearch:T,searchPlaceholder:"Savol yoki javob bo'yicha qidirish...",children:a.jsx(V,{columns:D,dataSource:M,rowKey:"id",loading:K,pagination:{pageSize:10}})}),a.jsxs(B,{title:u?"Savolni tahrirlash":"Yangi savol qo'shish",open:s,onClose:S,loading:j.isPending||F.isPending,form:g,onSubmit:P,isEdit:!!u,children:[a.jsx(c.Item,{name:"question",label:"Savol",rules:[{required:!0,message:"Savolni kiriting"}],children:a.jsx(E,{rows:2,placeholder:"Savol matni..."})}),a.jsx(c.Item,{name:"answer",label:"Javob",rules:[{required:!0,message:"Javobni kiriting"}],children:a.jsx(E,{rows:4,placeholder:"Javob matni..."})}),a.jsx(c.Item,{name:"categoryId",label:"Kategoriya",children:a.jsx(k,{placeholder:"Kategoriyani tanlang",allowClear:!0,children:(A=v==null?void 0:v.data)==null?void 0:A.map(e=>a.jsx(k.Option,{value:e._id||e.id,children:e.name},e._id||e.id))})}),a.jsx(c.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:a.jsx($,{min:1,className:"w-full"})}),a.jsx(c.Item,{name:"isActive",label:"Holati",valuePropName:"checked",initialValue:!0,children:a.jsx(Y,{checkedChildren:"Faol",unCheckedChildren:"Nofaol"})})]})]})};export{he as default};
