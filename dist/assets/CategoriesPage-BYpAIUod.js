import{r as p,G as Q,k as t,B as w}from"./index-F3grSWdG.js";import{u as U}from"./useClosable-uJIj1gsA.js";import{u as y,s as i}from"./index-DVxfzCL-.js";import"./client-CX91g6yc.js";import{c as d}from"./categories-C0Tbv_kI.js";import{C as L}from"./CrudDrawer-VwFJGtif.js";import{A as B}from"./ActionButtons-CRKm-3pF.js";import{P as H}from"./PageHeader-Cabh6d31.js";import{F as c}from"./index-Cv5QttRn.js";import{F as z}from"./Table-B2BAtLIv.js";import{I as S}from"./index-CZbTi1p4.js";import{C as O}from"./ColorPicker--QJ_YxRD.js";import{R as Y}from"./DeleteOutlined-iu_k66-Y.js";import{U as G,R as V}from"./UploadOutlined-C8kOzndP.js";import{T as _}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./index-C7_EJlaz.js";import"./DownOutlined-Bz--1KPw.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./index-Bf1aI_MO.js";import"./index-MhhX0jA_.js";import"./index-GxHbFEKO.js";const je=()=>{const[q,f]=p.useState(!1),[h,j]=p.useState(null),[m,u]=p.useState(null),[x]=c.useForm(),g=Q(),[k,v]=p.useState(""),{data:n,isLoading:M}=U({queryKey:["categories"],queryFn:()=>d.getAll()}),P=p.useMemo(()=>n!=null&&n.data?k?n.data.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())):n.data:[],[n==null?void 0:n.data,k]),C=y({mutationFn:e=>d.create(e),onSuccess:()=>{i.success("Kategoriya yaratildi"),g.invalidateQueries({queryKey:["categories"]}),I()},onError:e=>{var o,r,s,l;console.error("Create Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.message)||e.message||"Noma'lum xatolik";i.error(a)}}),b=y({mutationFn:({id:e,data:a})=>d.update(e,a),onSuccess:()=>{i.success("Kategoriya yangilandi"),g.invalidateQueries({queryKey:["categories"]}),I()},onError:e=>{var o,r,s,l;console.error("Update Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.message)||e.message||"Noma'lum xatolik";i.error(a)}}),F=y({mutationFn:e=>d.delete(e),onSuccess:()=>{i.success("Kategoriya o'chirildi"),g.invalidateQueries({queryKey:["categories"]})},onError:e=>{var o,r,s,l;console.error("Delete Category Error:",e);const a=((r=(o=e.response)==null?void 0:o.data)==null?void 0:r.error)||((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.message)||e.message||"Noma'lum xatolik";i.error(a)}}),E=y({mutationFn:({id:e,file:a})=>d.uploadImage(e,a),onSuccess:e=>{i.success("Rasm yuklandi!"),g.invalidateQueries({queryKey:["categories"]}),u(a=>{var o;return a&&{...a,image:(o=e.data)==null?void 0:o.image}})},onError:()=>i.error("Rasm yuklashda xatolik")}),K=y({mutationFn:e=>d.deleteImage(e),onSuccess:()=>{i.success("Rasm o'chirildi!"),g.invalidateQueries({queryKey:["categories"]}),u(e=>e&&{...e,image:void 0})},onError:()=>i.error("Rasm o'chirishda xatolik")}),A=()=>{j(null),u(null),x.resetFields(),f(!0)},T=e=>{j(e.id),u(e),x.setFieldsValue(e),f(!0)},I=()=>{f(!1),j(null),u(null),x.resetFields()},D=e=>{var s;const{image:a,...o}=e,r={...o,color:typeof o.color=="object"&&((s=o.color)!=null&&s.toHexString)?o.color.toHexString():o.color};h?b.mutate({id:h,data:r}):C.mutate(r)},R=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},N=[{title:"Rang",dataIndex:"color",key:"color",width:60,render:e=>t.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:e||"#ccc"}})},{title:"Nomi",dataIndex:"name",key:"name",render:(e,a)=>t.jsx(_,{color:a.color,children:e})},{title:"Slug",dataIndex:"slug",key:"slug"},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(B,{onEdit:()=>T(a),onDelete:()=>F.mutate(a.id),deleteLoading:F.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(H,{title:"Kategoriyalar",onAdd:A,addButtonText:"Yangi kategoriya",onSearch:v,searchPlaceholder:"Kategoriya nomi bo'yicha qidirish...",children:t.jsx(z,{columns:N,dataSource:P,rowKey:"id",loading:M,pagination:{pageSize:10}})}),t.jsxs(L,{title:h?"Kategoriyani tahrirlash":"Yangi kategoriya",open:q,onClose:I,loading:C.isPending||b.isPending,form:x,onSubmit:D,isEdit:!!h,children:[t.jsx(c.Item,{name:"name",label:"Kategoriya nomi",rules:[{required:!0,message:"Nomini kiriting"}],children:t.jsx(S,{placeholder:"Huquq sohasi"})}),t.jsx(c.Item,{name:"description",label:"Tavsif",children:t.jsx(S.TextArea,{rows:2,placeholder:"Kategoriya tavsifi"})}),t.jsx(c.Item,{name:"color",label:"Rang",children:t.jsx(O,{format:"hex"})}),t.jsx(c.Item,{name:"icon",label:"Icon (emoji yoki CSS class)",children:t.jsx(S,{placeholder:"ðŸŒ yoki fa-globe"})}),m&&t.jsx(c.Item,{label:"Rasm",children:t.jsxs("div",{className:"space-y-2",children:[R(m.image)&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:R(m.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),t.jsx(w,{danger:!0,size:"small",icon:t.jsx(Y,{}),onClick:()=>K.mutate(m.id),loading:K.isPending,style:{position:"absolute",top:8,right:8}})]}),t.jsx(G,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(E.mutate({id:m.id,file:e}),!1),children:t.jsx(w,{icon:t.jsx(V,{}),loading:E.isPending,children:"Rasm yuklash"})})]})})]})]})};export{je as default};
