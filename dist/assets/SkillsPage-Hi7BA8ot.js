import{r as f,G as O,k as a,B as M}from"./index-isBeRo1b.js";import{u as P}from"./useClosable-Dwegbn33.js";import{u as j,s as o}from"./index-DOY2cXOq.js";import{c as u}from"./client-D49sAvGJ.js";import{c as V}from"./categories--hKE1BeI.js";import{C as z}from"./CrudDrawer-CCohrQdE.js";import{A as Y}from"./ActionButtons-MGrXOT8T.js";import{P as H}from"./PageHeader-CzhsRgKs.js";import{F as g}from"./index-CO1TAYVF.js";import{F as _}from"./Table-CbaHfp0x.js";import{I as A}from"./index-BiEyZbEs.js";import{R as J}from"./DeleteOutlined-BdlBkdV1.js";import{U as W,R as X}from"./UploadOutlined-C9sZaBMJ.js";import{S as Z}from"./index-BaCf-Qju.js";import{S as N}from"./index-DeMcSX5K.js";import{T}from"./index-CDKBTdtS.js";import{T as ee}from"./index-DF4za2Tw.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./index-CUCRgLKV.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./DownOutlined-C7Jp90Yl.js";import"./index-Dh7qLhW3.js";const p={getAll:async i=>{const{data:t}=await u.get("/skills",{params:i});return t},getById:async i=>{const{data:t}=await u.get(`/skills/${i}`);return t},create:async i=>{const{data:t}=await u.post("/skills",i);return t},update:async(i,t)=>{const{data:n}=await u.put(`/skills/${i}`,t);return n},delete:async i=>{const{data:t}=await u.delete(`/skills/${i}`);return t},uploadImage:async(i,t)=>{const n=new FormData;n.append("image",t);const{data:h}=await u.put(`/skills/${i}/image`,n,{headers:{"Content-Type":"multipart/form-data"}});return h},deleteImage:async i=>{const{data:t}=await u.delete(`/skills/${i}/image`);return t}},be=()=>{var C;const[i,t]=f.useState(!1),[n,h]=f.useState(null),[y,k]=f.useState(null),[I]=g.useForm(),x=O(),[S,D]=f.useState(""),{data:l,isLoading:Q}=P({queryKey:["skills"],queryFn:()=>p.getAll()}),{data:w}=P({queryKey:["categories"],queryFn:()=>V.getAll()}),U=f.useMemo(()=>l!=null&&l.data?S?l.data.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())):l.data:[],[l==null?void 0:l.data,S]),F=j({mutationFn:e=>p.create(e),onSuccess:()=>{o.success("Ko'nikma yaratildi"),x.invalidateQueries({queryKey:["skills"]}),b()},onError:e=>{var r,d,m,c;console.error("Create Skill Error:",e);const s=((d=(r=e.response)==null?void 0:r.data)==null?void 0:d.error)||((c=(m=e.response)==null?void 0:m.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";o.error(s)}}),K=j({mutationFn:({id:e,data:s})=>p.update(e,s),onSuccess:()=>{o.success("Ko'nikma yangilandi"),x.invalidateQueries({queryKey:["skills"]}),b()},onError:e=>{var r,d,m,c;console.error("Update Skill Error:",e);const s=((d=(r=e.response)==null?void 0:r.data)==null?void 0:d.error)||((c=(m=e.response)==null?void 0:m.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";o.error(s)}}),q=j({mutationFn:e=>p.delete(e),onSuccess:()=>{o.success("Ko'nikma o'chirildi"),x.invalidateQueries({queryKey:["skills"]})},onError:e=>{var r,d,m,c;console.error("Delete Skill Error:",e);const s=((d=(r=e.response)==null?void 0:r.data)==null?void 0:d.error)||((c=(m=e.response)==null?void 0:m.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";o.error(s)}}),v=j({mutationFn:({id:e,file:s})=>p.uploadImage(e,s),onSuccess:e=>{o.success("Rasm yuklandi!"),x.invalidateQueries({queryKey:["skills"]}),k(s=>{var r;return s&&{...s,image:(r=e.data)==null?void 0:r.image}})},onError:()=>o.error("Rasm yuklashda xatolik")}),E=j({mutationFn:e=>p.deleteImage(e),onSuccess:()=>{o.success("Rasm o'chirildi!"),x.invalidateQueries({queryKey:["skills"]}),k(e=>e&&{...e,image:void 0})},onError:()=>o.error("Rasm o'chirishda xatolik")}),$=()=>{h(null),k(null),I.resetFields(),t(!0)},L=e=>{h(e.id),k(e),I.setFieldsValue(e),t(!0)},b=()=>{t(!1),h(null),k(null),I.resetFields()},B=e=>{const{image:s,...r}=e;n?K.mutate({id:n,data:r}):F.mutate(r)},R=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},G=[{title:"Icon",dataIndex:"icon",key:"icon",width:50,render:e=>e?a.jsx("img",{src:e,alt:"",style:{width:24,height:24}}):"-"},{title:"Nomi",dataIndex:"name",key:"name"},{title:"Daraja",dataIndex:"percentage",key:"percentage",render:e=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("div",{style:{width:100,height:6,background:"#f0f0f0",borderRadius:3},children:a.jsx("div",{style:{width:`${e}%`,height:"100%",background:"#1677ff",borderRadius:3}})}),a.jsxs("span",{children:[e,"%"]})]})},{title:"Kategoriya",dataIndex:"category",key:"category",render:e=>e?a.jsx(T,{color:e.color,children:e.name}):"-"},{title:"Amallar",key:"actions",width:100,render:(e,s)=>a.jsx(Y,{onEdit:()=>L(s),onDelete:()=>q.mutate(s.id),deleteLoading:q.isPending})}];return a.jsxs(a.Fragment,{children:[a.jsx(H,{title:"Ko'nikmalar",onAdd:$,addButtonText:"Yangi ko'nikma",onSearch:D,searchPlaceholder:"Ko'nikma nomi bo'yicha qidirish...",children:a.jsx(_,{columns:G,dataSource:U,rowKey:"id",loading:Q,pagination:{pageSize:10}})}),a.jsxs(z,{title:n?"Ko'nikmani tahrirlash":"Yangi ko'nikma",open:i,onClose:b,loading:F.isPending||K.isPending,form:I,onSubmit:B,isEdit:!!n,children:[a.jsx(g.Item,{name:"name",label:"Ko'nikma nomi",rules:[{required:!0,message:"Nomini kiriting"}],children:a.jsx(A,{placeholder:"Fuqarolik huquqi"})}),a.jsx(g.Item,{name:"icon",label:"Icon (URL)",tooltip:"SVG yoki PNG rasm havolasi",children:a.jsx(A,{placeholder:"https://example.com/icon.svg"})}),y&&a.jsx(g.Item,{label:"Rasm",children:a.jsxs("div",{className:"space-y-2",children:[R(y.image)&&a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:R(y.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),a.jsx(M,{danger:!0,size:"small",icon:a.jsx(J,{}),onClick:()=>E.mutate(y.id),loading:E.isPending,style:{position:"absolute",top:8,right:8}})]}),a.jsx(W,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(v.mutate({id:y.id,file:e}),!1),children:a.jsx(M,{icon:a.jsx(X,{}),loading:v.isPending,children:"Rasm yuklash"})})]})}),a.jsx(g.Item,{name:"percentage",label:"Daraja (%)",initialValue:50,children:a.jsx(Z,{marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"}})}),a.jsx(g.Item,{name:"category",label:"Kategoriya",children:a.jsx(N,{placeholder:"Kategoriya tanlang",allowClear:!0,children:(C=w==null?void 0:w.data)==null?void 0:C.map(e=>a.jsx(N.Option,{value:e.id,children:a.jsx(T,{color:e.color,children:e.name})},e.id))})}),a.jsx(g.Item,{name:"order",label:"Tartib raqami",children:a.jsx(ee,{min:0,className:"w-full"})})]})]})};export{be as default};
