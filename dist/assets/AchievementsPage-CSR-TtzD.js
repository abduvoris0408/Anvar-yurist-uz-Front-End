import{r as v,G as Q,k as t,B as D}from"./index-F3grSWdG.js";import{u as U}from"./useClosable-uJIj1gsA.js";import{u as j,s as o}from"./index-DVxfzCL-.js";import{c}from"./client-CX91g6yc.js";import{C as $}from"./CrudDrawer-VwFJGtif.js";import{A as L}from"./ActionButtons-CRKm-3pF.js";import{P as H}from"./PageHeader-Cabh6d31.js";import{d as E}from"./dayjs.min-DsquTRpG.js";import{F as h}from"./index-Cv5QttRn.js";import{F as z}from"./Table-B2BAtLIv.js";import{I as b}from"./index-CZbTi1p4.js";import{D as O}from"./index-CEqjeAe3.js";import{R as V}from"./DeleteOutlined-iu_k66-Y.js";import{U as G,R as _}from"./UploadOutlined-C8kOzndP.js";import{T as J}from"./index-MhhX0jA_.js";import{T as W}from"./index-DLxPakHX.js";import"./InfoCircleFilled-C9q2btrd.js";import"./index-Dj6CL_jc.js";import"./index-lsxE6RmN.js";import"./index-C7_EJlaz.js";import"./DownOutlined-Bz--1KPw.js";import"./QuestionCircleOutlined-NOAkvmT8.js";import"./index-Bf1aI_MO.js";const p={getAll:async i=>{const{data:s}=await c.get("/achievements",{params:i});return s},getById:async i=>{const{data:s}=await c.get(`/achievements/${i}`);return s},create:async i=>{const{data:s}=await c.post("/achievements",i);return s},update:async(i,s)=>{const{data:l}=await c.put(`/achievements/${i}`,s);return l},delete:async i=>{const{data:s}=await c.delete(`/achievements/${i}`);return s},uploadImage:async(i,s)=>{const l=new FormData;l.append("image",s);const{data:g}=await c.put(`/achievements/${i}/image`,l,{headers:{"Content-Type":"multipart/form-data"}});return g},deleteImage:async i=>{const{data:s}=await c.delete(`/achievements/${i}/image`);return s}},Ie=()=>{const[i,s]=v.useState(!1),[l,g]=v.useState(null),[y,f]=v.useState(null),[I]=h.useForm(),x=Q(),[w,R]=v.useState(""),{data:d,isLoading:T}=U({queryKey:["achievements"],queryFn:()=>p.getAll()}),C=v.useMemo(()=>d!=null&&d.data?w?d.data.filter(e=>e.title.toLowerCase().includes(w.toLowerCase())):d.data:[],[d==null?void 0:d.data,w]),k=j({mutationFn:e=>p.create(e),onSuccess:()=>{o.success("Yutuq yaratildi"),x.invalidateQueries({queryKey:["achievements"]}),Y()},onError:e=>{var r,n,u,m;console.error("Create Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(a)}}),F=j({mutationFn:({id:e,data:a})=>p.update(e,a),onSuccess:()=>{o.success("Yutuq yangilandi"),x.invalidateQueries({queryKey:["achievements"]}),Y()},onError:e=>{var r,n,u,m;console.error("Update Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(a)}}),M=j({mutationFn:e=>p.delete(e),onSuccess:()=>{o.success("Yutuq o'chirildi"),x.invalidateQueries({queryKey:["achievements"]})},onError:e=>{var r,n,u,m;console.error("Delete Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((m=(u=e.response)==null?void 0:u.data)==null?void 0:m.message)||e.message||"Noma'lum xatolik";o.error(a)}}),S=j({mutationFn:({id:e,file:a})=>p.uploadImage(e,a),onSuccess:e=>{o.success("Rasm yuklandi!"),x.invalidateQueries({queryKey:["achievements"]}),f(a=>{var r;return a&&{...a,image:(r=e.data)==null?void 0:r.image}})},onError:()=>o.error("Rasm yuklashda xatolik")}),A=j({mutationFn:e=>p.deleteImage(e),onSuccess:()=>{o.success("Rasm o'chirildi!"),x.invalidateQueries({queryKey:["achievements"]}),f(e=>e&&{...e,image:void 0})},onError:()=>o.error("Rasm o'chirishda xatolik")}),P=()=>{g(null),f(null),I.resetFields(),s(!0)},N=e=>{g(e.id),f(e),I.setFieldsValue({...e,date:e.date?E(e.date):null}),s(!0)},Y=()=>{s(!1),g(null),f(null),I.resetFields()},B=e=>{const{image:a,...r}=e,n={...r,date:r.date?r.date.format("YYYY-MM-DD"):void 0};l?F.mutate({id:l,data:n}):k.mutate(n)},q=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},K=[{title:"Rasm",dataIndex:"image",key:"image",width:60,render:e=>{const a=q(e);return a?t.jsx("img",{src:a,alt:"",style:{width:40,height:40,objectFit:"cover",borderRadius:6}}):"-"}},{title:"Yutuq",dataIndex:"title",key:"title"},{title:"Beruvchi",dataIndex:"issuer",key:"issuer"},{title:"Sana",dataIndex:"date",key:"date",render:e=>e?E(e).format("DD.MM.YYYY"):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>t.jsx(W,{color:e?"green":"red",children:e?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(L,{onEdit:()=>N(a),onDelete:()=>M.mutate(a.id),deleteLoading:M.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(H,{title:"Yutuqlar",onAdd:P,addButtonText:"Yangi yutuq",onSearch:R,searchPlaceholder:"Yutuq nomi bo'yicha qidirish...",children:t.jsx(z,{columns:K,dataSource:C,rowKey:"id",loading:T,pagination:{pageSize:10}})}),t.jsxs($,{title:l?"Yutuqni tahrirlash":"Yangi yutuq",open:i,onClose:Y,loading:k.isPending||F.isPending,form:I,onSubmit:B,isEdit:!!l,children:[t.jsx(h.Item,{name:"title",label:"Yutuq nomi",rules:[{required:!0,message:"Nomini kiriting"}],children:t.jsx(b,{placeholder:"Eng yaxshi himoya"})}),t.jsx(h.Item,{name:"description",label:"Tavsif",children:t.jsx(b.TextArea,{rows:3,placeholder:"Yutuq tavsifi"})}),t.jsx(h.Item,{name:"issuer",label:"Beruvchi tashkilot",children:t.jsx(b,{placeholder:"Yuristlar palatasi"})}),t.jsx(h.Item,{name:"date",label:"Sana",children:t.jsx(O,{className:"w-full",format:"YYYY-MM-DD"})}),y&&t.jsx(h.Item,{label:"Rasm/Hujjat",children:t.jsxs("div",{className:"space-y-2",children:[q(y.image)&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:q(y.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),t.jsx(D,{danger:!0,size:"small",icon:t.jsx(V,{}),onClick:()=>A.mutate(y.id),loading:A.isPending,style:{position:"absolute",top:8,right:8}})]}),t.jsx(G,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(S.mutate({id:y.id,file:e}),!1),children:t.jsx(D,{icon:t.jsx(_,{}),loading:S.isPending,children:"Rasm yuklash"})})]})}),t.jsx(h.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:t.jsx(J,{min:1,className:"w-full"})})]})]})};export{Ie as default};
