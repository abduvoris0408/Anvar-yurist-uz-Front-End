import{r as j,G as U,k as t,B as E}from"./index-isBeRo1b.js";import{u as $}from"./useClosable-Dwegbn33.js";import{u as f,s as o}from"./index-DOY2cXOq.js";import{c}from"./client-D49sAvGJ.js";import{C as H}from"./CrudDrawer-CCohrQdE.js";import{A as L}from"./ActionButtons-MGrXOT8T.js";import{P as z}from"./PageHeader-CzhsRgKs.js";import{u as O}from"./useDebounce-D60A3ZKm.js";import{d as M}from"./dayjs.min-D51Aj4CE.js";import{F as m}from"./index-CO1TAYVF.js";import{F as V}from"./Table-CbaHfp0x.js";import{I as w}from"./index-BiEyZbEs.js";import{D as G}from"./index-CNKLWfak.js";import{R as _}from"./DeleteOutlined-BdlBkdV1.js";import{U as J,R as W}from"./UploadOutlined-C9sZaBMJ.js";import{T as X}from"./index-DF4za2Tw.js";import{T as Z}from"./index-CDKBTdtS.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./index-CUCRgLKV.js";import"./index-DeMcSX5K.js";import"./DownOutlined-C7Jp90Yl.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./index-Dh7qLhW3.js";const h={getAll:async i=>{const{data:s}=await c.get("/achievements",{params:i});return s},getById:async i=>{const{data:s}=await c.get(`/achievements/${i}`);return s},create:async i=>{const{data:s}=await c.post("/achievements",i);return s},update:async(i,s)=>{const{data:l}=await c.put(`/achievements/${i}`,s);return l},delete:async i=>{const{data:s}=await c.delete(`/achievements/${i}`);return s},uploadImage:async(i,s)=>{const l=new FormData;l.append("image",s);const{data:p}=await c.put(`/achievements/${i}/image`,l,{headers:{"Content-Type":"multipart/form-data"}});return p},deleteImage:async i=>{const{data:s}=await c.delete(`/achievements/${i}/image`);return s}},we=()=>{const[i,s]=j.useState(!1),[l,p]=j.useState(null),[g,y]=j.useState(null),[v]=m.useForm(),x=U(),[R,T]=j.useState(""),b=O(R,500),{data:I,isLoading:P}=$({queryKey:["achievements",b],queryFn:()=>h.getAll({search:b})}),N=(I==null?void 0:I.data)||[],k=f({mutationFn:e=>h.create(e),onSuccess:()=>{o.success("Yutuq yaratildi"),x.invalidateQueries({queryKey:["achievements"]}),Y()},onError:e=>{var r,n,d,u;console.error("Create Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((u=(d=e.response)==null?void 0:d.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";o.error(a)}}),F=f({mutationFn:({id:e,data:a})=>h.update(e,a),onSuccess:()=>{o.success("Yutuq yangilandi"),x.invalidateQueries({queryKey:["achievements"]}),Y()},onError:e=>{var r,n,d,u;console.error("Update Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((u=(d=e.response)==null?void 0:d.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";o.error(a)}}),S=f({mutationFn:e=>h.delete(e),onSuccess:()=>{o.success("Yutuq o'chirildi"),x.invalidateQueries({queryKey:["achievements"]})},onError:e=>{var r,n,d,u;console.error("Delete Achievement Error:",e);const a=((n=(r=e.response)==null?void 0:r.data)==null?void 0:n.error)||((u=(d=e.response)==null?void 0:d.data)==null?void 0:u.message)||e.message||"Noma'lum xatolik";o.error(a)}}),D=f({mutationFn:({id:e,file:a})=>h.uploadImage(e,a),onSuccess:e=>{o.success("Rasm yuklandi!"),x.invalidateQueries({queryKey:["achievements"]}),y(a=>{var r;return a&&{...a,image:(r=e.data)==null?void 0:r.image}})},onError:()=>o.error("Rasm yuklashda xatolik")}),A=f({mutationFn:e=>h.deleteImage(e),onSuccess:()=>{o.success("Rasm o'chirildi!"),x.invalidateQueries({queryKey:["achievements"]}),y(e=>e&&{...e,image:void 0})},onError:()=>o.error("Rasm o'chirishda xatolik")}),C=()=>{p(null),y(null),v.resetFields(),s(!0)},B=e=>{p(e.id),y(e),v.setFieldsValue({...e,date:e.date?M(e.date):null}),s(!0)},Y=()=>{s(!1),p(null),y(null),v.resetFields()},K=e=>{const{image:a,...r}=e,n={...r,date:r.date?r.date.format("YYYY-MM-DD"):void 0};l?F.mutate({id:l,data:n}):k.mutate(n)},q=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},Q=[{title:"Rasm",dataIndex:"image",key:"image",width:60,render:e=>{const a=q(e);return a?t.jsx("img",{src:a,alt:"",style:{width:40,height:40,objectFit:"cover",borderRadius:6}}):"-"}},{title:"Yutuq",dataIndex:"title",key:"title"},{title:"Beruvchi",dataIndex:"issuer",key:"issuer"},{title:"Sana",dataIndex:"date",key:"date",render:e=>e?M(e).format("DD.MM.YYYY"):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>t.jsx(Z,{color:e?"green":"red",children:e?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(L,{onEdit:()=>B(a),onDelete:()=>S.mutate(a.id),deleteLoading:S.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(z,{title:"Yutuqlar",onAdd:C,addButtonText:"Yangi yutuq",onSearch:T,searchPlaceholder:"Yutuq nomi bo'yicha qidirish...",children:t.jsx(V,{columns:Q,dataSource:N,rowKey:"id",loading:P,pagination:{pageSize:10}})}),t.jsxs(H,{title:l?"Yutuqni tahrirlash":"Yangi yutuq",open:i,onClose:Y,loading:k.isPending||F.isPending,form:v,onSubmit:K,isEdit:!!l,children:[t.jsx(m.Item,{name:"title",label:"Yutuq nomi",rules:[{required:!0,message:"Nomini kiriting"}],children:t.jsx(w,{placeholder:"Eng yaxshi himoya"})}),t.jsx(m.Item,{name:"description",label:"Tavsif",children:t.jsx(w.TextArea,{rows:3,placeholder:"Yutuq tavsifi"})}),t.jsx(m.Item,{name:"issuer",label:"Beruvchi tashkilot",children:t.jsx(w,{placeholder:"Yuristlar palatasi"})}),t.jsx(m.Item,{name:"date",label:"Sana",children:t.jsx(G,{className:"w-full",format:"YYYY-MM-DD"})}),g&&t.jsx(m.Item,{label:"Rasm/Hujjat",children:t.jsxs("div",{className:"space-y-2",children:[q(g.image)&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:q(g.image),alt:"Preview",style:{width:"100%",height:120,objectFit:"cover",borderRadius:8}}),t.jsx(E,{danger:!0,size:"small",icon:t.jsx(_,{}),onClick:()=>A.mutate(g.id),loading:A.isPending,style:{position:"absolute",top:8,right:8}})]}),t.jsx(J,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(D.mutate({id:g.id,file:e}),!1),children:t.jsx(E,{icon:t.jsx(W,{}),loading:D.isPending,children:"Rasm yuklash"})})]})}),t.jsx(m.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:t.jsx(X,{min:1,className:"w-full"})})]})]})};export{we as default};
