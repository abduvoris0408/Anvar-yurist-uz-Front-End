import{r as k,G as U,k as t,B as N}from"./index-isBeRo1b.js";import{u as Q}from"./useClosable-Dwegbn33.js";import{u as f,s as n}from"./index-DOY2cXOq.js";import{c as u}from"./client-D49sAvGJ.js";import{C as $}from"./CrudDrawer-CCohrQdE.js";import{A as B}from"./ActionButtons-MGrXOT8T.js";import{P as V}from"./PageHeader-CzhsRgKs.js";import{u as z}from"./useDebounce-D60A3ZKm.js";import{F as m}from"./index-CO1TAYVF.js";import{F as O}from"./Table-CbaHfp0x.js";import{I as F}from"./index-BiEyZbEs.js";import{R as Y}from"./DeleteOutlined-BdlBkdV1.js";import{U as _,R as G}from"./UploadOutlined-C9sZaBMJ.js";import{T as J}from"./index-DF4za2Tw.js";import{S as W}from"./index-Aatx205e.js";import{A as X}from"./index-DFmE7rub.js";import{T as Z}from"./index-CDKBTdtS.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./index-CUCRgLKV.js";import"./index-DeMcSX5K.js";import"./DownOutlined-C7Jp90Yl.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./index-Dh7qLhW3.js";const p={getAll:async o=>{const{data:r}=await u.get("/partners",{params:o});return r},getById:async o=>{const{data:r}=await u.get(`/partners/${o}`);return r},create:async o=>{const{data:r}=await u.post("/partners",o);return r},update:async(o,r)=>{const{data:i}=await u.put(`/partners/${o}`,r);return i},delete:async o=>{const{data:r}=await u.delete(`/partners/${o}`);return r},uploadLogo:async(o,r)=>{const i=new FormData;i.append("logo",r);const{data:g}=await u.put(`/partners/${o}/logo`,i,{headers:{"Content-Type":"multipart/form-data"}});return g},deleteLogo:async o=>{const{data:r}=await u.delete(`/partners/${o}/logo`);return r}},{TextArea:ee}=F,Le=()=>{const[o,r]=k.useState(!1),[i,g]=k.useState(null),[h,x]=k.useState(null),[j]=m.useForm(),y=U(),[A,C]=k.useState(""),L=z(A,500),{data:b,isLoading:H}=Q({queryKey:["partners",L],queryFn:()=>p.getAll({search:L})}),T=(b==null?void 0:b.data)||[],S=f({mutationFn:e=>p.create(e),onSuccess:()=>{n.success("Hamkor yaratildi"),y.invalidateQueries({queryKey:["partners"]}),w()},onError:e=>{var s,l,d,c;console.error("Create Partner Error:",e);const a=((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";n.error(a)}}),q=f({mutationFn:({id:e,data:a})=>p.update(e,a),onSuccess:()=>{n.success("Hamkor yangilandi"),y.invalidateQueries({queryKey:["partners"]}),w()},onError:e=>{var s,l,d,c;console.error("Update Partner Error:",e);const a=((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";n.error(a)}}),P=f({mutationFn:e=>p.delete(e),onSuccess:()=>{n.success("Hamkor o'chirildi"),y.invalidateQueries({queryKey:["partners"]})},onError:e=>{var s,l,d,c;console.error("Delete Partner Error:",e);const a=((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.error)||((c=(d=e.response)==null?void 0:d.data)==null?void 0:c.message)||e.message||"Noma'lum xatolik";n.error(a)}}),v=f({mutationFn:({id:e,file:a})=>p.uploadLogo(e,a),onSuccess:e=>{n.success("Logo yuklandi!"),y.invalidateQueries({queryKey:["partners"]}),x(a=>{var s;return a&&{...a,logo:(s=e.data)==null?void 0:s.logo}})},onError:()=>n.error("Logo yuklashda xatolik")}),E=f({mutationFn:e=>p.deleteLogo(e),onSuccess:()=>{n.success("Logo o'chirildi!"),y.invalidateQueries({queryKey:["partners"]}),x(e=>e&&{...e,logo:void 0})},onError:()=>n.error("Logo o'chirishda xatolik")}),M=()=>{g(null),x(null),j.resetFields(),r(!0)},D=e=>{g(e.id),x(e),j.setFieldsValue(e),r(!0)},w=()=>{r(!1),g(null),x(null),j.resetFields()},K=e=>{const{logo:a,...s}=e;i?q.mutate({id:i,data:s}):S.mutate(s)},I=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},R=[{title:"Logo",dataIndex:"logo",key:"logo",render:e=>{const a=I(e);return t.jsx(X,{src:a,shape:"square",size:"large"})}},{title:"Nomi",dataIndex:"name",key:"name",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e}),a.description&&t.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:a.description})]})},{title:"Veb-sayt",dataIndex:"url",key:"url",render:e=>e?t.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:e}):"-"},{title:"Holat",dataIndex:"isActive",key:"isActive",render:e=>t.jsx(Z,{color:e?"green":"red",children:e?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:100,render:(e,a)=>t.jsx(B,{onEdit:()=>D(a),onDelete:()=>P.mutate(a.id),deleteLoading:P.isPending})}];return t.jsxs(t.Fragment,{children:[t.jsx(V,{title:"Hamkorlar",onAdd:M,addButtonText:"Yangi hamkor",onSearch:C,searchPlaceholder:"Hamkor nomi yoki URL bo'yicha qidirish...",children:t.jsx(O,{columns:R,dataSource:T,rowKey:"id",loading:H,pagination:{pageSize:10}})}),t.jsxs($,{title:i?"Hamkorni tahrirlash":"Yangi hamkor qo'shish",open:o,onClose:w,loading:S.isPending||q.isPending,form:j,onSubmit:K,isEdit:!!i,children:[t.jsx(m.Item,{name:"name",label:"Hamkor Nomi",rules:[{required:!0,message:"Hamkor nomini kiriting"}],children:t.jsx(F,{placeholder:"Kompaniya nomi"})}),t.jsx(m.Item,{name:"url",label:"Veb-sayt URL",children:t.jsx(F,{placeholder:"https://company.com"})}),h&&t.jsx(m.Item,{label:"Logo",children:t.jsxs("div",{className:"space-y-2",children:[I(h.logo)&&t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:I(h.logo),alt:"Logo",style:{width:80,height:80,objectFit:"contain",borderRadius:8,border:"1px solid #eee"}}),t.jsx(N,{danger:!0,size:"small",icon:t.jsx(Y,{}),onClick:()=>E.mutate(h.id),loading:E.isPending,style:{position:"absolute",top:-8,right:-8}})]}),t.jsx(_,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(v.mutate({id:h.id,file:e}),!1),children:t.jsx(N,{icon:t.jsx(G,{}),loading:v.isPending,children:"Logo yuklash"})})]})}),t.jsx(m.Item,{name:"description",label:"Tavsif",children:t.jsx(ee,{rows:3,placeholder:"Hamkor haqida qisqacha..."})}),t.jsx(m.Item,{name:"order",label:"Tartib raqami",initialValue:1,children:t.jsx(J,{min:1,className:"w-full"})}),t.jsx(m.Item,{name:"isActive",label:"Holati",valuePropName:"checked",initialValue:!0,children:t.jsx(W,{checkedChildren:"Faol",unCheckedChildren:"Nofaol"})})]})]})};export{Le as default};
