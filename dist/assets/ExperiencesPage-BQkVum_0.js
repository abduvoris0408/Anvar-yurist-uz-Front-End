import{r as f,G as P,k as a,B as v}from"./index-isBeRo1b.js";import{u as A}from"./useClosable-Dwegbn33.js";import{u as g,s as l}from"./index-DOY2cXOq.js";import{c as u}from"./client-D49sAvGJ.js";import{C as B}from"./CrudDrawer-CCohrQdE.js";import{A as R}from"./ActionButtons-MGrXOT8T.js";import{P as Q}from"./PageHeader-CzhsRgKs.js";import{d as j}from"./dayjs.min-D51Aj4CE.js";import{F as n}from"./index-CO1TAYVF.js";import{F as U}from"./Table-CbaHfp0x.js";import{I as p}from"./index-BiEyZbEs.js";import{R as $}from"./DeleteOutlined-BdlBkdV1.js";import{U as N,R as H}from"./UploadOutlined-C9sZaBMJ.js";import{S as J}from"./index-CUCRgLKV.js";import{D as F}from"./index-CNKLWfak.js";import{S as O}from"./index-Aatx205e.js";import{T as X}from"./index-CDKBTdtS.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-CK1P3WPV.js";import"./index-DeMcSX5K.js";import"./DownOutlined-C7Jp90Yl.js";import"./QuestionCircleOutlined-DwuYyw29.js";import"./index-Dh7qLhW3.js";const m={getAll:async s=>{const{data:r}=await u.get("/experiences",{params:s});return r},getById:async s=>{const{data:r}=await u.get(`/experiences/${s}`);return r},create:async s=>{const{data:r}=await u.post("/experiences",s);return r},update:async(s,r)=>{const{data:i}=await u.put(`/experiences/${s}`,r);return i},delete:async s=>{const{data:r}=await u.delete(`/experiences/${s}`);return r},uploadLogo:async(s,r)=>{const i=new FormData;i.append("logo",r);const{data:c}=await u.put(`/experiences/${s}/logo`,i,{headers:{"Content-Type":"multipart/form-data"}});return c},deleteLogo:async s=>{const{data:r}=await u.delete(`/experiences/${s}/logo`);return r}},{TextArea:_}=p,je=()=>{const[s,r]=f.useState(!1),[i,c]=f.useState(null),[h,z]=f.useState(""),[x]=n.useForm(),y=P(),{data:d,isLoading:q}=A({queryKey:["experiences"],queryFn:()=>m.getAll({limit:100})}),C=f.useMemo(()=>h?((d==null?void 0:d.data)||[]).filter(e=>{var t,o;return e.company.toLowerCase().includes(h.toLowerCase())||((t=e.position)==null?void 0:t.toLowerCase().includes(h.toLowerCase()))||((o=e.location)==null?void 0:o.toLowerCase().includes(h.toLowerCase()))}):(d==null?void 0:d.data)||[],[d==null?void 0:d.data,h]),L=g({mutationFn:e=>m.create(e),onSuccess:()=>{l.success("Tajriba yaratildi!"),y.invalidateQueries({queryKey:["experiences"]}),w()},onError:e=>{var t,o;l.error(((o=(t=e.response)==null?void 0:t.data)==null?void 0:o.error)||e.message||"Xatolik yuz berdi")}}),D=g({mutationFn:({id:e,data:t})=>m.update(e,t),onSuccess:()=>{l.success("Tajriba yangilandi!"),y.invalidateQueries({queryKey:["experiences"]}),w()},onError:e=>{var t,o;l.error(((o=(t=e.response)==null?void 0:t.data)==null?void 0:o.error)||e.message||"Xatolik yuz berdi")}}),Y=g({mutationFn:e=>m.delete(e),onSuccess:()=>{l.success("Tajriba o'chirildi!"),y.invalidateQueries({queryKey:["experiences"]})},onError:()=>l.error("Xatolik yuz berdi")}),I=g({mutationFn:({id:e,file:t})=>m.uploadLogo(e,t),onSuccess:e=>{l.success("Logo yuklandi!"),y.invalidateQueries({queryKey:["experiences"]}),c(t=>{var o;return t&&{...t,companyLogo:(o=e.data)==null?void 0:o.companyLogo}})},onError:()=>l.error("Logo yuklashda xatolik")}),M=g({mutationFn:e=>m.deleteLogo(e),onSuccess:()=>{l.success("Logo o'chirildi!"),y.invalidateQueries({queryKey:["experiences"]}),c(e=>e&&{...e,companyLogo:void 0})},onError:()=>l.error("Logo o'chirishda xatolik")}),b=e=>{if(e){if(typeof e=="string")return e;if(typeof e=="object"&&e.url)return e.url}},k=e=>{e?(c(e),x.setFieldsValue({...e,startDate:e.startDate?j(e.startDate):null,endDate:e.endDate?j(e.endDate):null})):(c(null),x.resetFields()),r(!0)},w=()=>{r(!1),c(null),x.resetFields()},T=async e=>{const{companyLogo:t,...o}=e,S={...o,startDate:o.startDate?o.startDate.format("YYYY-MM-DD"):void 0,endDate:o.current?null:o.endDate?o.endDate.format("YYYY-MM-DD"):void 0,specializations:typeof o.specializations=="string"?o.specializations.split(",").map(K=>K.trim()).filter(Boolean):o.specializations};i?D.mutate({id:i.id,data:S}):L.mutate(S)},E=[{title:"Logo",dataIndex:"companyLogo",key:"companyLogo",width:50,render:e=>{const t=b(e);return t?a.jsx("img",{src:t,alt:"",style:{width:32,height:32,objectFit:"contain",borderRadius:4}}):"-"}},{title:"Kompaniya",dataIndex:"company",key:"company",sorter:(e,t)=>e.company.localeCompare(t.company),render:e=>a.jsx("strong",{children:e})},{title:"Lavozim",dataIndex:"position",key:"position"},{title:"Joylashuv",dataIndex:"location",key:"location"},{title:"Davr",key:"period",render:(e,t)=>a.jsxs("span",{children:[j(t.startDate).format("MMM YYYY")," - ",t.current?a.jsx(X,{color:"green",children:"Hozir"}):j(t.endDate).format("MMM YYYY")]})},{title:"Amallar",key:"actions",width:100,render:(e,t)=>a.jsx(R,{onEdit:()=>k(t),onDelete:()=>Y.mutate(t.id),deleteLoading:Y.isPending})}];return a.jsxs(a.Fragment,{children:[a.jsx(Q,{title:"Ish Tajribasi",onAdd:()=>k(),addButtonText:"Yangi tajriba",onSearch:z,searchPlaceholder:"Tajribani qidirish...",children:a.jsx(U,{columns:E,dataSource:C,rowKey:"id",loading:q,pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Jami: ${e}`},size:"middle"})}),a.jsxs(B,{open:s,onClose:w,title:i?"Tajribani tahrirlash":"Yangi tajriba",loading:L.isPending||D.isPending,form:x,onSubmit:T,isEdit:!!i,width:450,children:[a.jsx(n.Item,{name:"company",label:"Kompaniya",rules:[{required:!0}],children:a.jsx(p,{placeholder:"Yuridik firma"})}),a.jsx(n.Item,{name:"position",label:"Lavozim",rules:[{required:!0}],children:a.jsx(p,{placeholder:"Bosh yurist"})}),a.jsx(n.Item,{name:"location",label:"Joylashuv",children:a.jsx(p,{placeholder:"San Francisco, CA"})}),a.jsx(n.Item,{name:"description",label:"Tavsif",children:a.jsx(_,{rows:3,placeholder:"Ish haqida ma'lumot"})}),i&&a.jsx(n.Item,{label:"Kompaniya logosi",children:a.jsxs("div",{className:"space-y-2",children:[b(i.companyLogo)&&a.jsxs("div",{className:"relative inline-block",children:[a.jsx("img",{src:b(i.companyLogo),alt:"Logo",style:{width:64,height:64,objectFit:"contain",borderRadius:8,border:"1px solid #eee"}}),a.jsx(v,{danger:!0,size:"small",icon:a.jsx($,{}),onClick:()=>M.mutate(i.id),loading:M.isPending,style:{position:"absolute",top:-8,right:-8}})]}),a.jsx(N,{showUploadList:!1,accept:"image/*",beforeUpload:e=>(I.mutate({id:i.id,file:e}),!1),children:a.jsx(v,{icon:a.jsx(H,{}),loading:I.isPending,children:"Logo yuklash"})})]})}),a.jsxs(J,{className:"w-full",size:"middle",children:[a.jsx(n.Item,{name:"startDate",label:"Boshlanish",rules:[{required:!0}],children:a.jsx(F,{className:"w-full",format:"YYYY-MM-DD"})}),a.jsx(n.Item,{name:"endDate",label:"Tugash",children:a.jsx(F,{className:"w-full",format:"YYYY-MM-DD"})})]}),a.jsx(n.Item,{name:"current",label:"Hozirda ishlayapman",valuePropName:"checked",children:a.jsx(O,{})}),a.jsx(n.Item,{name:"specializations",label:"Ixtisoslashuvlar (vergul bilan)",children:a.jsx(p,{placeholder:"Korporativ huquq, Mehnat huquqi"})}),a.jsx(n.Item,{name:"companyUrl",label:"Kompaniya URL",children:a.jsx(p,{placeholder:"https://firma.uz"})})]})]})};export{je as default};
