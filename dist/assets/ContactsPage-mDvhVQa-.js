import{r as c,I as M,_ as A,G as q,k as e,B as u}from"./index-isBeRo1b.js";import{u as Y}from"./useClosable-Dwegbn33.js";import{u as y,s as d}from"./index-DOY2cXOq.js";import{c as m,n as $,R as O}from"./client-D49sAvGJ.js";import{P as D}from"./PageHeader-CzhsRgKs.js";import{d as x}from"./dayjs.min-D51Aj4CE.js";import{F as E}from"./Table-CbaHfp0x.js";import{D as F}from"./index-CK1P3WPV.js";import{D as l}from"./index-DPMtK3Ee.js";import{S as o}from"./index-CUCRgLKV.js";import{R as v}from"./MailOutlined-BOfDKj4-.js";import{T as n}from"./index-CDKBTdtS.js";import{P as N}from"./index-DeMcSX5K.js";import{R as P}from"./DeleteOutlined-BdlBkdV1.js";import"./InfoCircleFilled-Ko0Gchp7.js";import"./index-BiEyZbEs.js";import"./DownOutlined-C7Jp90Yl.js";import"./index-Dh7qLhW3.js";var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},H=function(r,p){return c.createElement(M,A({},r,{ref:p,icon:X}))},T=c.forwardRef(H);const h={getAll:async a=>{const{data:r}=await m.get("/contacts",{params:a});return r},getById:async a=>{const{data:r}=await m.get(`/contacts/${a}`);return r},markAsRead:async a=>{const{data:r}=await m.put(`/contacts/${a}/read`);return r},markAsReplied:async a=>{const{data:r}=await m.put(`/contacts/${a}/reply`);return r},delete:async a=>{const{data:r}=await m.delete(`/contacts/${a}`);return r}},le=()=>{const[a,r]=c.useState(null),[p,b]=c.useState(!1),[j,R]=c.useState(""),g=q(),{data:i,isLoading:w}=Y({queryKey:["contacts"],queryFn:()=>h.getAll()}),C=c.useMemo(()=>{if(!(i!=null&&i.data))return[];if(!j)return i.data;const t=j.toLowerCase();return i.data.filter(s=>s.name.toLowerCase().includes(t)||s.email.toLowerCase().includes(t)||s.subject.toLowerCase().includes(t))},[i==null?void 0:i.data,j]),S=y({mutationFn:t=>h.markAsRead(t),onSuccess:()=>{g.invalidateQueries({queryKey:["contacts"]}),a&&r(t=>t?{...t,isRead:!0}:null)},onError:()=>d.error("Xatolik yuz berdi")}),k=y({mutationFn:t=>h.markAsReplied(t),onSuccess:()=>{d.success("Xabar javob berildi deb belgilandi"),g.invalidateQueries({queryKey:["contacts"]}),a&&r(t=>t?{...t,isReplied:!0}:null)},onError:()=>d.error("Xatolik yuz berdi")}),f=y({mutationFn:t=>h.delete(t),onSuccess:()=>{d.success("Xabar o'chirildi"),g.invalidateQueries({queryKey:["contacts"]}),b(!1)},onError:()=>d.error("Xatolik yuz berdi")}),I=t=>{r(t),b(!0),t.isRead||S.mutate(t.id)},z=[{title:"Ism",dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(o,{direction:"vertical",size:0,children:[e.jsx("span",{className:"font-medium",children:t}),e.jsx("span",{className:"text-xs text-gray-400",children:s.email})]})},{title:"Mavzu",dataIndex:"subject",key:"subject",ellipsis:!0},{title:"Holat",key:"status",render:(t,s)=>e.jsxs(o,{children:[s.isRead?e.jsx(n,{color:"blue",children:"O'qilgan"}):e.jsx(n,{color:"gold",children:"Yangi"}),s.isReplied&&e.jsx(n,{color:"green",children:"Javob berilgan"})]})},{title:"Sana",dataIndex:"createdAt",key:"createdAt",render:t=>x(t).format("DD.MM.YYYY HH:mm"),sorter:(t,s)=>x(t.createdAt).unix()-x(s.createdAt).unix(),defaultSortOrder:"descend"},{title:"Amallar",key:"actions",width:120,render:(t,s)=>e.jsxs(o,{children:[e.jsx($,{title:"Ko'rish",children:e.jsx(u,{color:"primary",variant:"outlined",size:"small",icon:e.jsx(O,{}),onClick:()=>I(s)})}),e.jsx(N,{title:"O'chirishni tasdiqlaysizmi?",onConfirm:()=>f.mutate(s.id),children:e.jsx(u,{size:"small",danger:!0,icon:e.jsx(P,{}),loading:f.isPending&&f.variables===s.id})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Aloqa Xabarlari",subtitle:"Foydalanuvchilardan kelgan xabarlar",onSearch:R,searchPlaceholder:"Ism, email yoki mavzu bo'yicha...",children:e.jsx(E,{columns:z,dataSource:C,rowKey:"id",loading:w,pagination:{pageSize:10}})}),e.jsx(F,{title:"Xabar tafsilotlari",open:p,onClose:()=>b(!1),width:500,extra:e.jsx(o,{children:a&&!a.isReplied&&e.jsx(u,{type:"primary",icon:e.jsx(T,{}),onClick:()=>k.mutate(a.id),loading:k.isPending,children:"Javob berildi"})}),children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{column:1,bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Yuboruvchi",children:a.name}),e.jsx(l.Item,{label:"Email",children:e.jsxs(o,{children:[e.jsx(v,{}),e.jsx("a",{href:`mailto:${a.email}`,children:a.email})]})}),a.phone&&e.jsx(l.Item,{label:"Telefon",children:a.phone}),e.jsx(l.Item,{label:"Sana",children:x(a.createdAt).format("DD MMMM YYYY, HH:mm")}),e.jsx(l.Item,{label:"Status",children:e.jsxs(o,{children:[a.isRead?e.jsx(n,{color:"blue",children:"O'qilgan"}):e.jsx(n,{color:"gold",children:"Yangi"}),a.isReplied?e.jsx(n,{color:"green",children:"Javob berilgan"}):e.jsx(n,{color:"default",children:"Javob kutilmoqda"})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 mb-2 text-xs uppercase tracking-wide font-semibold",children:"Mavzu"}),e.jsx("div",{className:"text-lg font-medium mb-4",children:a.subject}),e.jsx("div",{className:"text-gray-500 mb-2 text-xs uppercase tracking-wide font-semibold",children:"Xabar"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 dark:border-gray-700 text-base leading-relaxed whitespace-pre-wrap",children:a.message})]}),!a.isReplied&&e.jsx("div",{className:"pt-4 border-t border-gray-100 dark:border-gray-700",children:e.jsx(u,{type:"dashed",block:!0,icon:e.jsx(v,{}),href:`mailto:${a.email}?subject=Re: ${a.subject}`,children:"Email orqali javob yozish"})})]})})]})};export{le as default};
